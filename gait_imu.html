<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>NeuroMap-MOT | åŒé‡ä»»åŠ¡æ­¥æ€ä¸ IMU åŠ¨åŠ›å­¦ (ç§‘ç ”å®Œå…¨ä½“ v4.0)</title>
    <style>
        /* ==================== UI ä¸è‰²å½©è§„èŒƒ ==================== */
        :root { --primary: #1e293b; --blue: #4f46e5; --emerald: #059669; --teal: #0d9488; --red: #f43f5e; --orange: #f59e0b; --slate: #64748b; --bg: #fcfcfd; }
        body { font-family: -apple-system, sans-serif; background: var(--bg); margin: 0; padding: 20px; color: var(--primary); user-select: none; }
        .container { max-width: 900px; margin: 0 auto 30px; background: white; padding: 40px; border-radius: 24px; box-shadow: 0 10px 30px rgba(0,0,0,0.03); border: 1px solid #f1f5f9; }
        .hidden { display: none !important; }
        
        .module-header { border-left: 6px solid var(--emerald); padding-left: 15px; margin-bottom: 25px; }
        .module-header h2 { margin: 0; font-size: 22px; color: var(--primary); }
        .module-header p { margin: 5px 0 0 0; color: var(--slate); font-size: 14px; line-height: 1.6; }

        /* ä¸´åºŠæŒ‡å¯¼è¯­åŒºå— */
        .instruction-box { background: #ecfdf5; border: 2px dashed #6ee7b7; padding: 25px; border-radius: 16px; margin-bottom: 25px; }
        .instruction-box p { margin: 0 0 10px 0; color: #047857; font-weight: bold; font-size: 16px; }
        .instruction-box ul { margin: 0; padding-left: 20px; color: #065f46; font-size: 15px; line-height: 1.5; }

        /* å®æ—¶çŠ¶æ€ä¸æ³¢å½¢å›¾ */
        .status-board { display: flex; justify-content: space-between; align-items: center; background: #f8fafc; padding: 15px 25px; border-radius: 16px; border: 2px solid #e2e8f0; margin-bottom: 20px; }
        .timer-display { font-size: 32px; font-weight: bold; color: var(--primary); font-family: monospace; }
        .timer-alert { color: var(--red); animation: pulse 1s infinite; }
        @keyframes pulse { 0% { opacity: 1; } 50% { opacity: 0.5; } 100% { opacity: 1; } }
        
        .imu-visualizer { width: 100%; height: 180px; background: #0f172a; border-radius: 16px; margin-bottom: 25px; box-shadow: inset 0 0 20px rgba(0,0,0,0.5); position: relative; overflow: hidden; }
        canvas { display: block; width: 100%; height: 100%; }
        .sensor-badge { position: absolute; top: 15px; left: 15px; background: rgba(255,255,255,0.1); border: 1px solid rgba(255,255,255,0.2); color: #94a3b8; font-size: 12px; padding: 4px 10px; border-radius: 8px; backdrop-filter: blur(4px); font-family: monospace; }

        /* æ§åˆ¶æŒ‰é’® */
        .controls-board { display: grid; grid-template-columns: 1fr 1fr; gap: 15px; margin-bottom: 30px; }
        .sys-btn { padding: 20px; border: none; border-radius: 16px; font-size: 18px; font-weight: bold; cursor: pointer; transition: 0.2s; display: flex; align-items: center; justify-content: center; gap: 10px; }
        .btn-auth { background: var(--blue); color: white; grid-column: span 2; box-shadow: 0 8px 20px rgba(79, 70, 229, 0.2); }
        .btn-auth:hover { background: #4338ca; transform: translateY(-2px); }
        .btn-record { background: var(--emerald); color: white; box-shadow: 0 8px 20px rgba(5, 150, 105, 0.2); }
        .btn-record:hover { background: #047857; transform: translateY(-2px); }
        .btn-record:disabled { background: #cbd5e1; box-shadow: none; cursor: not-allowed; transform: none; }
        .btn-stop { background: var(--red); color: white; box-shadow: 0 8px 20px rgba(244, 63, 94, 0.2); }
        .btn-stop:hover { background: #e11d48; transform: translateY(-2px); }
        .btn-stop:disabled { background: #cbd5e1; box-shadow: none; cursor: not-allowed; transform: none;}

        /* ç‰¹å¾è®¡ç®—é¢æ¿ */
        .metrics-board { display: grid; grid-template-columns: repeat(3, 1fr); gap: 15px; margin-top: 20px; }
        .metric-card { background: white; border: 1px solid #e2e8f0; padding: 15px; border-radius: 12px; text-align: center; }
        .metric-card span { display: block; font-size: 12px; color: var(--slate); font-weight: bold; margin-bottom: 5px; }
        .metric-card strong { font-size: 26px; color: var(--emerald); font-family: monospace; }

        /* ä¸‹è½½åŒº */
        .download-box { background: #fffbeb; border: 2px dashed #fcd34d; padding: 25px; border-radius: 16px; text-align: center; margin-top: 30px; }
        .btn-download { background: var(--orange); color: white; padding: 18px 30px; border-radius: 12px; font-size: 16px; font-weight: bold; cursor: pointer; border: none; transition: 0.2s; box-shadow: 0 5px 15px rgba(245, 158, 11, 0.2);}
        .btn-download:hover { background: #d97706; transform: translateY(-2px); }
    </style>
    <script src="cas-storage.js"></script>
</head>
<body>
    <button onclick="location.href='index.html'" style="background:none; border:none; color:var(--emerald); font-weight:bold; cursor:pointer; font-size:16px; margin-bottom:20px;">â† è¿”å›æ§åˆ¶å°</button>

    <div class="container">
        <div class="module-header">
            <h2>ğŸš¶â€â™‚ï¸ åŒé‡ä»»åŠ¡æ­¥æ€è¯„ä¼° (Dual-Task Gait)</h2>
            <p><strong>ä¸´åºŠé¶å‘ï¼š</strong>è¯„ä¼°é¢å¶æ‰§è¡Œæ§åˆ¶ä¸è¿åŠ¨ç½‘ç»œçš„å¹²æ‰°æ•ˆåº”ã€‚<br>
            *åŸºäºæ‰‹æœºå†…ç½®é«˜é¢‘ä¸‰è½´åŠ é€Ÿåº¦è®¡ (IMU)ï¼Œè‡ªåŠ¨è¯†åˆ«æ­¥æ€è§¦åœ°äº‹ä»¶ (Heel-Strike)ï¼Œè®¡ç®—æ­¥é¢‘ä¸æ­¥æ—¶å˜å¼‚ç³»æ•° (CV)ã€‚</p>
        </div>

        <div class="instruction-box">
            <p>âš ï¸ ä¸´åºŠæ ‡å‡†æ“ä½œè§„ç¨‹ (SOP)ï¼š</p>
            <ul>
                <li><strong>è®¾å¤‡ä½©æˆ´ï¼š</strong>è¯·å°†è£…æœ‰æœ¬ç³»ç»Ÿçš„æ‰‹æœº/å¹³æ¿ï¼Œç´§è´´æ”¾å…¥å—è¯•è€…å‰ä¾§è£¤å…œï¼Œæˆ–ç”¨è…°å¸¦å›ºå®šäºä¸‹èƒŒéƒ¨ (L4-L5ä½ç½®)ã€‚</li>
                <li><strong>åŒé‡ä»»åŠ¡ï¼š</strong>å—è¯•è€…éœ€ä»¥å¹³æ—¶çš„æ­£å¸¸é€Ÿåº¦å‘å‰è¡Œèµ° 30 ç§’ï¼Œ<strong>åŒæ—¶å¤§å£°ä» 100 å¼€å§‹è¿ç»­å‡ 7</strong> (100, 93, 86...)ã€‚</li>
                <li><strong>å¯åŠ¨é¡ºåºï¼š</strong>ä¸»è¯•ç‚¹å‡»ä¸‹æ–¹å¼€å§‹è®°å½•ï¼Œå¾…å€’è®¡æ—¶ç»“æŸå¬åˆ°â€œæ»´â€å£°åï¼Œå—è¯•è€…èµ·æ­¥ã€‚</li>
            </ul>
        </div>

        <button class="sys-btn btn-auth" id="btn-auth" onclick="requestDeviceMotion()">ğŸ”“ æ­¥éª¤1: æˆæƒæ¿€æ´»åº•å±‚è¿åŠ¨ä¼ æ„Ÿå™¨ (å¿…ç‚¹)</button>

        <div class="status-board hidden" id="test-workspace">
            <div style="color: var(--slate); font-weight:bold; display:flex; align-items:center; gap:8px;">
                <span style="display:inline-block; width:12px; height:12px; border-radius:50%; background:var(--emerald);" id="status-dot"></span>
                <span id="status-text">ä¼ æ„Ÿå™¨å·²å°±ç»ªï¼Œç­‰å¾…å¼€å§‹</span>
            </div>
            <div class="timer-display" id="time-display">30.0 s</div>
        </div>

        <div class="imu-visualizer hidden" id="canvas-workspace">
            <div class="sensor-badge">Abs Acceleration (m/sÂ²)</div>
            <canvas id="imu-canvas"></canvas>
        </div>

        <div class="controls-board hidden" id="controls-workspace">
            <button class="sys-btn btn-record" id="btn-record" onclick="startGaitTest()">â–¶ æ­¥éª¤2: å¯åŠ¨ 30 ç§’æ­¥æ€é‡‡é›†</button>
            <button class="sys-btn btn-stop" id="btn-stop" onclick="stopGaitTest()" disabled>â¹ï¸ ç´§æ€¥åœæ­¢</button>
        </div>

        <div class="metrics-board" style="opacity: 0.3; pointer-events: none;" id="metrics-board">
            <div class="metric-card"><span>æ€»æœ‰æ•ˆæ­¥æ•° (Steps)</span><strong id="m-steps">0</strong></div>
            <div class="metric-card"><span>æ­¥é¢‘ (Cadence) [æ­¥/åˆ†]</span><strong id="m-cadence">0.0</strong></div>
            <div class="metric-card"><span>æ­¥æ—¶å˜å¼‚ç³»æ•° (CV)</span><strong id="m-cv" style="color:var(--red);">0.0 %</strong></div>
        </div>

        <div id="download-area" class="download-box hidden">
            <h3 style="color:#b45309; margin-top:0;">âœ… æ­¥æ€æ—¶åºç‰¹å¾åº“å·²å°±ç»ª</h3>
            <p style="font-size:14px; color:#92400e; margin-bottom:20px;">æ‘˜è¦æŒ‡æ ‡å·²å­˜å…¥ç³»ç»Ÿä¸»åº“ã€‚ä¸ºç¡®ä¿ä¸´åºŠçº§ç²¾åº¦ï¼Œç³»ç»Ÿä¿ç•™äº† 60Hz é‡‡æ ·ç‡ä¸‹çš„æ‰€æœ‰åŸå§‹ä¸‰è½´å‘é‡ä¸åˆæˆéœ‡å¹…æ•°æ®ã€‚å¼ºçƒˆå»ºè®®ä¸‹è½½ä¸º CSV æ¡£æ¡ˆï¼Œä»¥ä¾¿å¯¼å…¥çŸ©é˜µè¿ç®—å¹³å°è¿›è¡Œé¢‘è°±åˆ†ææˆ–éçº¿æ€§ç‰¹å¾æå–ã€‚</p>
            <button class="btn-download" id="btn-download-csv">â¬‡ï¸ å¯¼å‡ºå®Œæ•´é«˜é¢‘æ—¶åºæ•°æ® (CSV)</button>
        </div>
    </div>

    <script>
        const TEST_DURATION = 30.0; 
        let timeLeft = TEST_DURATION;
        let testInterval = null;
        let isTesting = false;

        // æ ¸å¿ƒæ—¶åºæ•°æ®æ± 
        let rawImuData = []; 
        let stepTimestamps = [];
        let testOnset = 0;

        // ç”»å¸ƒä¸æ¸²æŸ“å‚æ•°
        const canvas = document.getElementById('imu-canvas');
        const ctx = canvas.getContext('2d', { willReadFrequently: true });
        let animationId;
        const historyData = new Array(150).fill(0); // ç”¨äºåœ¨ Canvas ä¸Šæ»šåŠ¨æ˜¾ç¤ºæœ€è¿‘çš„ 150 å¸§
        
        function resizeCanvas() { canvas.width = canvas.parentElement.clientWidth; canvas.height = canvas.parentElement.clientHeight; }
        window.addEventListener('resize', resizeCanvas); resizeCanvas();

        // ç®—æ³•æ§åˆ¶å‚æ•°ï¼šå³°å€¼æ£€æµ‹ (æ­¥æ€è§¦åœ°äº‹ä»¶)
        let lastPeakTime = 0;
        let dynamicThreshold = 11.5; // åŠ¨æ€é˜ˆå€¼ï¼Œé€šå¸¸æ­£å¸¸èµ°åŠ¨çš„åˆæˆåŠ é€Ÿåº¦å³°å€¼åœ¨ 12-15 m/sÂ² å·¦å³
        const MIN_STEP_TIME_MS = 350; // æé€Ÿé˜²æŠ–ï¼šä¸¤æ­¥ä¹‹é—´ä¸å¯èƒ½ä½äº 350ms

        // ================= 1. ä¼ æ„Ÿå™¨æˆæƒ (è§£å†³ iOS 13+ å®‰å…¨é™åˆ¶) =================
        function requestDeviceMotion() {
            if (typeof DeviceMotionEvent !== 'undefined' && typeof DeviceMotionEvent.requestPermission === 'function') {
                DeviceMotionEvent.requestPermission()
                    .then(permissionState => {
                        if (permissionState === 'granted') initSensorUI();
                        else alert('âš ï¸ æˆæƒè¢«æ‹’ç»ï¼Œæ— æ³•è¯»å–ä¼ æ„Ÿå™¨ã€‚è¯·åœ¨ç³»ç»Ÿè®¾ç½®ä¸­å…è®¸æµè§ˆå™¨è®¿é—®ä¼ æ„Ÿå™¨ã€‚');
                    })
                    .catch(console.error);
            } else {
                // é iOS 13+ è®¾å¤‡æˆ– Androidï¼Œç›´æ¥åˆå§‹åŒ–
                initSensorUI();
            }
        }

        function initSensorUI() {
            document.getElementById('btn-auth').classList.add('hidden');
            document.getElementById('test-workspace').classList.remove('hidden');
            document.getElementById('canvas-workspace').classList.remove('hidden');
            document.getElementById('controls-workspace').classList.remove('hidden');
            
            // é¢„æŒ‚è½½ç›‘å¬å™¨ï¼Œç”¨äºæ³¢å½¢å±•ç¤ºï¼Œä½†ä¸æ­£å¼å½•å…¥æ•°æ®
            window.addEventListener('devicemotion', handleDeviceMotion);
            drawOscilloscope();
        }

        // ================= 2. æ•°æ®é‡‡é›†ä¸å®æ—¶æ³¢å½¢ =================
        function handleDeviceMotion(event) {
            // ä¼˜å…ˆä½¿ç”¨åŒ…å«é‡åŠ›çš„åŠ é€Ÿåº¦ (æ›´ç¨³å¥)ï¼Œå¦‚æœæ²¡æœ‰åˆ™ä½¿ç”¨çº¯çº¿æ€§åŠ é€Ÿåº¦åŠ ä¸ŠåŸºçº¿ G
            let acc = event.accelerationIncludingGravity || event.acceleration;
            if(!acc || acc.x === null) return;

            // è®¡ç®—ç©ºé—´ç»å¯¹åˆæˆçŸ¢é‡ M = sqrt(x^2 + y^2 + z^2)
            let x = acc.x; let y = acc.y; let z = acc.z;
            let magnitude = Math.sqrt(x*x + y*y + z*z);

            // å°†æœ€æ–°æ•°æ®æ¨å…¥ç”»å›¾æ•°ç»„
            historyData.push(magnitude);
            historyData.shift();

            // å¦‚æœåœ¨æµ‹è¯•çŠ¶æ€ï¼Œè¿›è¡Œé«˜é¢‘é˜µåˆ—å‹å…¥ä¸å®æ—¶æ­¥æ•°è®¡ç®—
            if (isTesting) {
                const now = performance.now();
                const relTime = now - testOnset;
                
                rawImuData.push({ t: Math.round(relTime), x: x.toFixed(3), y: y.toFixed(3), z: z.toFixed(3), m: magnitude.toFixed(3) });

                // å®æ—¶å³°å€¼æ£€æµ‹ (Heel-Strike Algorithm)
                if (magnitude > dynamicThreshold && (now - lastPeakTime) > MIN_STEP_TIME_MS) {
                    stepTimestamps.push(now);
                    lastPeakTime = now;
                    document.getElementById('m-steps').innerText = stepTimestamps.length;
                    
                    // åŠ¨æ€æ›´æ–°é˜ˆå€¼ï¼Œé€‚åº”å—è¯•è€…çš„å®é™…æ­¥å¹…åŠ›é‡
                    dynamicThreshold = (dynamicThreshold * 0.9) + (magnitude * 0.1); 
                }
            }
        }

        function drawOscilloscope() {
            animationId = requestAnimationFrame(drawOscilloscope);
            
            ctx.fillStyle = '#0f172a';
            ctx.fillRect(0, 0, canvas.width, canvas.height);
            
            // ç»˜åˆ¶ 9.8 (1G) çš„åŸºå‡†çº¿
            const baselineY = canvas.height - (9.8 / 25) * canvas.height;
            ctx.strokeStyle = '#334155';
            ctx.lineWidth = 1;
            ctx.beginPath();
            ctx.moveTo(0, baselineY); ctx.lineTo(canvas.width, baselineY);
            ctx.stroke();

            // ç»˜åˆ¶åŠ¨æ€æŠ˜çº¿
            ctx.strokeStyle = '#059669';
            ctx.lineWidth = 3;
            ctx.beginPath();
            
            const sliceWidth = canvas.width / historyData.length;
            let drawX = 0;
            
            for(let i=0; i<historyData.length; i++) {
                // å‡è®¾æ­£å¸¸èµ°è·¯å³°å€¼ä¸è¶…è¿‡ 25 m/sÂ²ï¼Œç¼©æ”¾æ˜ å°„
                let drawY = canvas.height - (historyData[i] / 25) * canvas.height;
                if (i === 0) ctx.moveTo(drawX, drawY);
                else ctx.lineTo(drawX, drawY);
                drawX += sliceWidth;
            }
            ctx.stroke();
        }

        // ================= 3. æ ¸å¿ƒæµ‹è¯•æ§åˆ¶ =================
        function startGaitTest() {
            rawImuData = [];
            stepTimestamps = [];
            timeLeft = TEST_DURATION;
            isTesting = true;
            testOnset = performance.now();
            lastPeakTime = testOnset;
            dynamicThreshold = 11.5; // é‡ç½®é˜ˆå€¼

            document.getElementById('btn-record').disabled = true;
            document.getElementById('btn-stop').disabled = false;
            document.getElementById('status-dot').style.background = 'var(--red)';
            document.getElementById('status-dot').classList.add('timer-alert');
            document.getElementById('status-text').innerText = "é‡‡é›†ä¸­ï¼Œè¯·å—è¯•è€…ä¿æŒèµ°åŠ¨å¹¶å‡7...";
            document.getElementById('status-text').style.color = 'var(--red)';
            document.getElementById('metrics-board').style.opacity = '0.3';
            document.getElementById('download-area').classList.add('hidden');

            testInterval = setInterval(() => {
                timeLeft -= 0.1;
                document.getElementById('time-display').innerText = timeLeft.toFixed(1) + ' s';
                
                if (timeLeft <= 5.0) document.getElementById('time-display').classList.add('timer-alert');
                
                if (timeLeft <= 0) {
                    stopGaitTest();
                }
            }, 100);
        }

        function stopGaitTest() {
            clearInterval(testInterval);
            isTesting = false;
            
            document.getElementById('time-display').classList.remove('timer-alert');
            document.getElementById('btn-record').disabled = false;
            document.getElementById('btn-record').innerText = "ğŸ”„ é‡æ–°æµ‹è¯•";
            document.getElementById('btn-stop').disabled = true;
            document.getElementById('status-dot').style.background = 'var(--emerald)';
            document.getElementById('status-dot').classList.remove('timer-alert');
            document.getElementById('status-text').innerText = "é‡‡é›†å®Œæ¯•ï¼Œæ­£åœ¨è®¡ç®—ç‰¹å¾çŸ©é˜µ...";
            document.getElementById('status-text').style.color = 'var(--primary)';

            calculateGaitMetrics();
        }

        // ================= 4. ç”Ÿç‰©åŠ›å­¦ç‰¹å¾è®¡ç®—ä¸ä¸‹è½½ =================
        function calculateGaitMetrics() {
            const steps = stepTimestamps.length;
            
            // å‰”é™¤å‰åå™ªéŸ³ï¼Œè®¡ç®—æœ‰æ•ˆçš„æ­¥æ€å‘¨æœŸ (Stride Times)
            let strideTimes = [];
            for (let i = 1; i < steps; i++) {
                strideTimes.push(stepTimestamps[i] - stepTimestamps[i-1]);
            }

            let cadence = 0;
            let cv = 0;

            if (strideTimes.length > 2) {
                // è®¡ç®—æ­¥é¢‘ (Cadence) = (æ€»æ­¥æ•° / å®é™…èµ°è·¯è€—æ—¶ç§’) * 60
                const walkDurationSec = (stepTimestamps[steps-1] - stepTimestamps[0]) / 1000;
                cadence = (steps / walkDurationSec) * 60;

                // è®¡ç®—æ­¥æ—¶å˜å¼‚ç³»æ•° (CV = StdDev / Mean * 100)
                const meanStride = strideTimes.reduce((a,b)=>a+b,0) / strideTimes.length;
                const variance = strideTimes.reduce((a,b)=>a+Math.pow(b-meanStride, 2), 0) / strideTimes.length;
                cv = (Math.sqrt(variance) / meanStride) * 100;
            }

            // æ›´æ–°é¢æ¿
            document.getElementById('metrics-board').style.opacity = '1';
            document.getElementById('m-steps').innerText = steps;
            document.getElementById('m-cadence').innerText = cadence.toFixed(1);
            document.getElementById('m-cv').innerText = cv.toFixed(2) + ' %';
            
            if (cv > 5.0) document.getElementById('m-cv').style.color = 'var(--red)';
            else document.getElementById('m-cv').style.color = 'var(--teal)';

            // æ‘˜è¦å­˜å…¥ CAS æ€»æ•°æ®åº“
            let gaitSummary = {
                module: "MOT_DualTaskGait",
                summary: {
                    total_steps: steps,
                    cadence_spm: parseFloat(cadence.toFixed(2)),
                    stride_time_cv_percent: parseFloat(cv.toFixed(2)),
                    test_duration_sec: TEST_DURATION
                }
            };
            CAS_Storage.saveModuleData('MOT_DualTaskGait', gaitSummary);

            // å‡†å¤‡ CSV ä¸‹è½½
            setupCSVDownload();

            let msg = `âœ… åŒé‡ä»»åŠ¡æ­¥æ€ç‰¹å¾å·²å…¥åº“ï¼\n\n- æ€»æ­¥æ•°: ${steps} æ­¥\n- æ­¥é¢‘: ${cadence.toFixed(1)} æ­¥/åˆ†\n- æ­¥æ—¶å˜å¼‚ç³»æ•° (CV): ${cv.toFixed(2)}%\n\n`;
            if (cv > 5.0) {
                msg += "âš ï¸ ä¸´åºŠæç¤ºï¼šåœ¨åŒé‡ä»»åŠ¡å¹²æ‰°ä¸‹ï¼Œå—è¯•è€…çš„æ­¥æ€å˜å¼‚ç³»æ•° (CV > 5%) æ˜¾è‘—å¢é«˜ï¼Œæç¤ºå‰é¢å¶æ‰§è¡Œèµ„æºåˆ†é…ä¸è¶³ï¼Œå­˜åœ¨æé«˜çš„è½»åº¦è®¤çŸ¥éšœç¢ (MCI) è½¬åŒ–é£é™©æˆ–è·Œå€’é£é™©ã€‚";
            }
            alert(msg);
        }

        function setupCSVDownload() {
            const dlArea = document.getElementById('download-area');
            const dlBtn = document.getElementById('btn-download-csv');
            dlArea.classList.remove('hidden');

            dlBtn.onclick = () => {
                // ç”Ÿæˆ CSV å¤´
                let csvContent = "data:text/csv;charset=utf-8,Time_ms,Acc_X,Acc_Y,Acc_Z,Magnitude\n";
                rawImuData.forEach(row => {
                    csvContent += `${row.t},${row.x},${row.y},${row.z},${row.m}\n`;
                });

                const encodedUri = encodeURI(csvContent);
                const a = document.createElement("a");
                a.setAttribute("href", encodedUri);
                a.setAttribute("download", `CAS_IMU_DualTaskGait_${new Date().getTime()}.csv`);
                document.body.appendChild(a);
                a.click();
                document.body.removeChild(a);
            };
        }
    </script>
</body>
</html>
