<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <title>CAS - ä¸´åºŠæŒ‡æ ‡è§£æä¸æ•°æ®æ±‡æ€»</title>
    <style>
        /* ç§‘æŠ€æ¸©æƒ…é£ UI */
        :root { 
            --primary: #1e293b; --blue: #4f46e5; --light-blue: #eef2ff; 
            --green: #10b981; --red: #f43f5e; --amber: #f59e0b; 
            --purple: #8b5cf6; --teal: #0d9488; --yellow: #eab308; --slate: #64748b; 
        }
        body { font-family: -apple-system, "PingFang SC", sans-serif; background: #fcfcfd; padding: 30px; color: #334155; line-height: 1.6; }
        .container { max-width: 1000px; margin: auto; background: white; padding: 45px; border-radius: 24px; box-shadow: 0 10px 40px rgba(0,0,0,0.05); }
        h2 { color: var(--blue); border-bottom: 3px solid var(--light-blue); padding-bottom: 15px; display: flex; align-items: center; gap: 10px; margin-top: 0;}
        
        /* 1. åŸºçº¿ä¿¡æ¯ */
        .info-grid { display: grid; grid-template-columns: repeat(3, 1fr); gap: 20px; margin-bottom: 30px; background: #f8fafc; padding: 25px; border-radius: 16px; border: 1px solid #e2e8f0; }
        .info-item span { display: block; font-size: 13.5px; color: var(--slate); margin-bottom: 5px; font-weight: bold; }
        .info-item strong { font-size: 18px; color: var(--primary); }

        /* 2. è¿›åº¦æ¡ */
        .progress-box { margin-bottom: 40px; }
        .progress-bar { width: 100%; height: 16px; background: #e2e8f0; border-radius: 8px; overflow: hidden; margin-top: 10px; }
        .progress-fill { height: 100%; background: var(--green); width: 0%; transition: width 1s cubic-bezier(0.17, 0.67, 0.83, 0.67); }
        
        /* ================= ğŸŒŸ æ–°å¢ï¼šå¯è§†åŒ–æ€»ç»“å›¾è¡¨ ================= */
        .chart-container { background: white; padding: 30px; border-radius: 20px; margin-bottom: 35px; border: 1px solid #e2e8f0; box-shadow: 0 4px 15px rgba(0,0,0,0.02); }
        .chart-container h3 { margin-top: 0; color: var(--primary); display: flex; justify-content: space-between; align-items: center; }
        .chart-badge { font-size: 13px; background: var(--light-blue); color: var(--blue); padding: 5px 12px; border-radius: 12px; font-weight: normal; }
        
        .bar-row { display: flex; align-items: center; margin-bottom: 15px; }
        .bar-label { width: 140px; font-weight: bold; color: var(--slate); font-size: 14.5px; display: flex; align-items: center; gap: 8px; }
        .bar-track { flex: 1; height: 20px; background: #f1f5f9; border-radius: 10px; overflow: hidden; position: relative; }
        .bar-fill { height: 100%; border-radius: 10px; width: 0%; transition: width 1.5s cubic-bezier(0.17, 0.67, 0.83, 0.67); }
        .bar-value { width: 50px; text-align: right; font-weight: bold; color: var(--primary); font-size: 16px; }

        /* å®šä¹‰å„é¢†åŸŸçš„é¢œè‰² */
        .fill-cog { background: linear-gradient(90deg, #818cf8, #4f46e5); }
        .fill-emo { background: linear-gradient(90deg, #fb7185, #e11d48); }
        .fill-mot { background: linear-gradient(90deg, #fcd34d, #f59e0b); }
        .fill-sen { background: linear-gradient(90deg, #fef08a, #eab308); }
        .fill-lan { background: linear-gradient(90deg, #c084fc, #9333ea); }
        .fill-lif { background: linear-gradient(90deg, #2dd4bf, #0d9488); }

        /* 4. æ ¸å¿ƒæŒ‡æ ‡é¢æ¿ (ä¿ç•™åŸæœ‰çš„å¤åˆ¶ç”¨æ–‡æœ¬) */
        .results-box { background: #f8fafc; padding: 30px; border-radius: 20px; margin-bottom: 35px; border: 2px dashed #cbd5e1; }
        .results-box h3 { color: var(--primary); margin-top: 0; border-bottom: 2px solid #e2e8f0; padding-bottom: 10px;}
        .result-item { font-size: 15.5px; margin-bottom: 12px; display: flex; justify-content: space-between; border-bottom: 1px solid #e2e8f0; padding-bottom: 10px; color: var(--slate); }
        .result-item strong { color: var(--primary); font-size: 16px; }
        .alert-text { color: var(--red); font-weight: bold; font-size: 14px; background: #fff1f2; padding: 2px 8px; border-radius: 6px; margin-left: 10px;}

        /* 5. åº•éƒ¨æŒ‰é’®ä¸æºç åŒº */
        .btn-group { display: grid; grid-template-columns: 2fr 1fr; gap: 20px; margin-top: 10px; }
        .btn { padding: 20px; border: none; border-radius: 16px; font-size: 16px; font-weight: bold; cursor: pointer; transition: 0.2s; }
        .btn-export { background: var(--green); color: white; font-size: 18px; box-shadow: 0 8px 20px rgba(16, 185, 129, 0.2); }
        .btn-export:hover { background: #059669; transform: translateY(-2px); }
        .btn-preview { background: var(--slate); color: white; }
        
        .preview-box { background: #0f172a; padding: 20px; border-radius: 16px; margin-top: 25px; display: none; }
        .preview-box textarea { width: 100%; height: 300px; background: transparent; color: #10b981; border: none; font-family: monospace; font-size: 14px; outline: none; resize: vertical; }
    </style>
    <script src="cas-storage.js"></script>
</head>
<body>
    <button onclick="location.href='index.html'" style="background:none; border:none; color:var(--blue); font-weight:bold; cursor:pointer; font-size: 16px; margin-bottom: 20px;">â† è¿”å›æµ‹è¯•æ§åˆ¶å°</button>

    <div class="container">
        <h2>ğŸ“Š CAS ä¸´åºŠæ•°æ®è§£æä¸å¯è§†åŒ–æŠ¥å‘Š</h2>
        
        <div class="info-grid" id="info-panel">
            <div class="info-item"><span>è¢«è¯• ID</span><strong id="r-id">-</strong></div>
            <div class="info-item"><span>å§“åç¼©å†™</span><strong id="r-name">-</strong></div>
            <div class="info-item"><span>æ€§åˆ« / å‡ºç”Ÿ</span><strong id="r-bio">-</strong></div>
            <div class="info-item"><span>åˆ©æ‰‹ (Handedness)</span><strong id="r-hand">-</strong></div>
            <div class="info-item"><span>æ•™è‚²æ°´å¹³ (Education)</span><strong id="r-edu">-</strong></div>
            <div class="info-item"><span>æŠ¥å‘Šç”Ÿæˆæ—¶é—´</span><strong id="r-time">-</strong></div>
        </div>

        <div class="progress-box">
            <div style="display:flex; justify-content:space-between; font-weight:bold; margin-bottom: 8px;">
                <span style="color:var(--primary);">æ ¸å¿ƒæ¨¡å—å®Œæˆåº¦ (ç›®æ ‡: 22 é¡¹)</span>
                <span id="prog-text" style="color:var(--green);">0%</span>
            </div>
            <div class="progress-bar"><div class="progress-fill" id="fill"></div></div>
        </div>

        <div class="chart-container">
            <h3>å…­å¤§ç¥ç»è®¤çŸ¥é¢†åŸŸé›·è¾¾è§†å›¾ <span class="chart-badge">100åˆ†ä¸ºå¸¸æ¨¡åŸºçº¿</span></h3>
            
            <div class="bar-row">
                <div class="bar-label"><span>ğŸ§ </span> è®¤çŸ¥æ‰§è¡Œ (COG)</div>
                <div class="bar-track"><div class="bar-fill fill-cog" id="bar-cog"></div></div>
                <div class="bar-value" id="val-cog">0</div>
            </div>
            <div class="bar-row">
                <div class="bar-label"><span>â¤ï¸</span> æƒ…ç»ªç¤¾ä¼š (EMO)</div>
                <div class="bar-track"><div class="bar-fill fill-emo" id="bar-emo"></div></div>
                <div class="bar-value" id="val-emo">0</div>
            </div>
            <div class="bar-row">
                <div class="bar-label"><span>ğŸ¯</span> è¿åŠ¨å…±æµ (MOT)</div>
                <div class="bar-track"><div class="bar-fill fill-mot" id="bar-mot"></div></div>
                <div class="bar-value" id="val-mot">0</div>
            </div>
            <div class="bar-row">
                <div class="bar-label"><span>âš¡</span> æ„Ÿè§‰çŸ¥è§‰ (SEN)</div>
                <div class="bar-track"><div class="bar-fill fill-sen" id="bar-sen"></div></div>
                <div class="bar-value" id="val-sen">0</div>
            </div>
            <div class="bar-row">
                <div class="bar-label"><span>ğŸ’¬</span> è¯­è¨€ç½‘ç»œ (LAN)</div>
                <div class="bar-track"><div class="bar-fill fill-lan" id="bar-lan"></div></div>
                <div class="bar-value" id="val-lan">0</div>
            </div>
            <div class="bar-row">
                <div class="bar-label"><span>ğŸŒ™</span> ç”Ÿæ´»åŠŸèƒ½ (LIF)</div>
                <div class="bar-track"><div class="bar-fill fill-lif" id="bar-lif"></div></div>
                <div class="bar-value" id="val-lif">0</div>
            </div>
            <p style="margin: 15px 0 0 0; font-size: 13px; color: var(--slate); text-align: right;">* æ­¤å›¾è¡¨åŸºäºå·²å®Œæˆçš„èŒƒå¼è‡ªåŠ¨æ¢ç®—ï¼Œä¾›ä¸´åºŠåŒ»ç”Ÿå¿«é€Ÿå®šä½è¡°é€€ç»´åº¦ã€‚</p>
        </div>

        <div class="results-box" id="readable-results">
            <h3>ğŸ“‹ ç¥ç»å¿ƒç†å­¦æ ¸å¿ƒæŒ‡æ ‡è§£æ (ä¾›å¤åˆ¶)</h3>
            <div id="results-content">
                <p style="color:var(--slate); font-size:14px;">ç­‰å¾…æµ‹è¯•æ•°æ®å†™å…¥... æŠ¥å‘Šå¼•æ“å°†è‡ªåŠ¨è§£æå…³é”®æŒ‡æ ‡ã€‚</p>
            </div>
        </div>

        <div class="btn-group">
            <button class="btn btn-export" onclick="CAS_Storage.exportJSON()">ğŸ“¥ ç¡®è®¤æ— è¯¯ï¼Œä¸€é”®å¯¼å‡ºæ•°æ®åŒ…ä¾› AI å»ºæ¨¡</button>
            <button class="btn btn-preview" onclick="togglePreview()">ğŸ‘€ å±•å¼€ JSON æºç </button>
        </div>

        <div class="preview-box" id="preview-panel">
            <textarea id="json-code" readonly></textarea>
        </div>
    </div>

    <script>
        window.onload = function() {
            const session = CAS_Storage.getSession();
            
            // 1. å¡«å……åŸºçº¿æ•°æ®
            if(session && session.demographics) {
                document.getElementById('r-id').innerText = session.demographics.subject_id || '-';
                document.getElementById('r-name').innerText = session.demographics.name || '-';
                document.getElementById('r-bio').innerText = `${session.demographics.gender} / ${session.demographics.dob}`;
                document.getElementById('r-hand').innerText = session.demographics.handedness || '-';
                document.getElementById('r-edu').innerText = session.demographics.education_level || '-';
                document.getElementById('r-time').innerText = new Date(session.start_time).toLocaleString();
            }

            const mods = session.modules || {};
            // 2. è¿›åº¦æ¡ (åŸºäº22é¡¹)
            const completedCount = Object.keys(mods).length;
            const pct = Math.min(Math.round((completedCount / 22) * 100), 100);
            setTimeout(() => { document.getElementById('fill').style.width = pct + '%'; }, 300);
            document.getElementById('prog-text').innerText = `${pct}% (${completedCount} æ¨¡å—å®Œæˆ)`;

            // ================= 3. æ ¸å¿ƒæŒ‡æ ‡æ–‡æœ¬è§£æä¸å›¾è¡¨æ•°æ®æ¢ç®— =================
            let resHTML = '';
            let chartScores = { COG: 0, EMO: 0, MOT: 0, SEN: 0, LAN: 0, LIF: 100 }; // LIF é»˜è®¤æ»¡åˆ†ï¼Œæ‰£åˆ†åˆ¶
            
            // ã€è®¤çŸ¥ COGã€‘
            if(mods['COG_Corsi']) {
                let span = mods['COG_Corsi'].data.max_span;
                resHTML += `<div class="result-item"><span>ğŸ§© Corsi ç©ºé—´å·¥ä½œè®°å¿†æé™å¹¿åº¦ (Span):</span> <strong>${span}</strong></div>`;
                chartScores.COG = Math.min(100, Math.round((span / 9) * 100)); // å‡è®¾9ä¸ºæ»¡åˆ†
            }
            if(mods['COG_TMT_B']) {
                resHTML += `<div class="result-item"><span>ğŸ”— TMT-B è®¤çŸ¥æŸ”æ€§ (è€—æ—¶ / é”™è¯¯):</span> <strong>${mods['COG_TMT_B'].data.total_time_ms} ms / ${mods['COG_TMT_B'].data.errors} æ¬¡</strong></div>`;
            }

            // ã€æƒ…æ„Ÿ EMOã€‘
            if(mods['Emotion_FER']) {
                const recs = mods['Emotion_FER'].data.records;
                const acc = Math.round((recs.filter(r => r.correct).length / recs.length) * 100) || 0;
                resHTML += `<div class="result-item"><span>ğŸ˜ƒ FER é¢å­”æƒ…ç»ªè¯†åˆ«å‡†ç¡®ç‡:</span> <strong>${acc}%</strong></div>`;
                chartScores.EMO = acc; // ç›´æ¥å–å‡†ç¡®ç‡
            }
            if(mods['Emotion_BART']) {
                resHTML += `<div class="result-item"><span>ğŸˆ BART é£é™©å†³ç­–æ€»æ”¶ç›Š:</span> <strong>$${mods['Emotion_BART'].data.total_gain}</strong></div>`;
            }

            // ã€è¿åŠ¨ MOTã€‘
            if(mods['MOT_Tapping']) {
                let taps = mods['MOT_Tapping'].data.total_taps;
                resHTML += `<div class="result-item"><span>â±ï¸ Tapping 10ç§’å¿«é€Ÿæ•²å‡»æ€»æ•°:</span> <strong>${taps} æ¬¡</strong></div>`;
                chartScores.MOT = Math.min(100, Math.round((taps / 60) * 100)); // å‡è®¾10ç§’60æ¬¡ä¸º100åˆ†
            }
            // ã€åŒé‡ä»»åŠ¡æ­¥æ€ Dual-Task Gaitã€‘
           if(mods['MOT_DualTaskGait']) {
               const gait = mods['MOT_DualTaskGait'].data.summary;
              // å˜å¼‚ç³»æ•°è¿‡å¤§æç¤ºæ­¥æ€æåº¦ä¸å¹³ç¨³
              let alert = gait.variability_cv > 25.0 ? `<span class="alert-text">æ­¥æ€å˜å¼‚æ€§å¼‚å¸¸(é«˜è·Œå€’é£é™©)</span>` : "";
              resHTML += `<div class="result-item"><span>ğŸš¶â€â™‚ï¸ åŒé‡ä»»åŠ¡æ­¥æ€ (æ­¥é¢‘ / å˜å¼‚ç³»æ•°):</span> <strong>${gait.cadence_spm} æ­¥/åˆ† | ${gait.variability_cv}% ${alert}</strong></div>`;
            // è‹¥éœ€è®¡å…¥å›¾è¡¨å¾—åˆ†ï¼Œæ­¥é¢‘ä½ä¸”å˜å¼‚é«˜åˆ™æ‰£åˆ†
              chartScores.MOT = (chartScores.MOT + Math.max(0, 100 - (gait.variability_cv * 2))) / 2;
            }
            // ã€ä¹¦å†™åŠ¨åŠ›å­¦ dCDTã€‘
           if(mods['MOT_dCDT']) {
               const dcdt = mods['MOT_dCDT'].data.summary;
              // ä¸´åºŠé˜ˆå€¼ï¼šç©ºä¸­æ€è€ƒæ—¶é—´(In-air time)å æ€»è€—æ—¶çš„æ¯”ä¾‹è¿‡é«˜ï¼Œæˆ–ç»å¯¹å€¼å¤§äº10ç§’
              let alert = dcdt.in_air_sec > 10 ? `<span class="alert-text">æ€è€ƒåœé¡¿å¼‚å¸¸å¢å¤š</span>` : "";
              resHTML += `<div class="result-item"><span>âœï¸ ç”»é’ŸåŠ¨åŠ›å­¦ (è½ç¬” / ç©ºä¸­æ€è€ƒ):</span> <strong>${dcdt.on_surface_sec}s / ${dcdt.in_air_sec}s ${alert}</strong></div>`;
              // è‹¥éœ€è®¡å…¥å›¾è¡¨ï¼Œå¯åšé€‚å½“æ¢ç®—
              chartScores.MOT = (chartScores.MOT + Math.max(0, 100 - (dcdt.in_air_sec * 2))) / 2;
            }

            // ã€æ„Ÿè§‰ SENã€‘
            if(mods['SEN_GoNoGo']) {
                const recs = mods['SEN_GoNoGo'].data.records;
                const acc = Math.round((recs.filter(r => r.correct).length / recs.length) * 100) || 0;
                resHTML += `<div class="result-item"><span>ğŸ›‘ Go/No-Go å†²åŠ¨æŠ‘åˆ¶å‡†ç¡®ç‡:</span> <strong>${acc}%</strong></div>`;
                chartScores.SEN = acc;
            }

            // ã€è¯­è¨€ LANã€‘
            if(mods['Language_VFT']) {
                const words = mods['Language_VFT'].data.words ? mods['Language_VFT'].data.words.length : 0;
                resHTML += `<div class="result-item"><span>ğŸ—£ï¸ VFT è¯­éŸ³è¯æ±‡æå–æ•°é‡ (1åˆ†é’Ÿ):</span> <strong>${words} è¯</strong></div>`;
                chartScores.LAN = Math.min(100, Math.round((words / 20) * 100)); // å‡è®¾1åˆ†é’Ÿ20è¯ä¸º100åˆ†
            }
           // ã€è¯­éŸ³æ ‡å¿—ç‰© VBMã€‘
            if(mods['Voice_Biomarkers']) {
               const vbm = mods['Voice_Biomarkers'].data;
           // ä¸´åºŠé˜ˆå€¼ï¼šåœé¡¿æ¯”è¶…è¿‡ 40% æç¤ºå¯èƒ½å­˜åœ¨æ‰¾è¯å›°éš¾æˆ–æ‰§è¡ŒåŠŸèƒ½ä¸‹é™
               let alert = vbm.pause_ratio > 40 ? `<span class="alert-text">è¯é—´åœé¡¿å¼‚å¸¸å¢å¤š</span>` : "";
            resHTML += `<div class="result-item"><span>ğŸ™ï¸ VBM è¯­éŸ³ç‰¹å¾ (æ€»æ—¶é•¿ / åœé¡¿æ¯”):</span> <strong>${vbm.duration_sec}s / ${vbm.pause_ratio}% ${alert}</strong></div>`;
           // è‹¥éœ€åŠ å…¥é›·è¾¾å›¾ï¼Œå¯æ ¹æ®åœé¡¿æ¯”åå‘æ¢ç®—åˆ†æ•°
           chartScores.LAN = (chartScores.LAN + Math.max(0, 100 - vbm.pause_ratio)) / 2; // ä¸è¯­ä¹‰æµç•…æ€§èåˆè®¡åˆ†
           }
            // ã€ç”Ÿæ´» LIFã€‘
            if(mods['Lifestyle_IADL']) {
                const iadlScore = mods['Lifestyle_IADL'].data.iadl_impairment_score;
                let alert = iadlScore > 0 ? `<span class="alert-text">å·¥å…·æ€§æ—¥å¸¸å—æŸ</span>` : "";
                resHTML += `<div class="result-item"><span>ğŸ› ï¸ IADL éšœç¢å¾—åˆ† (è¶Šé«˜è¶Šå·®):</span> <strong>${iadlScore} åˆ† ${alert}</strong></div>`;
                chartScores.LIF -= (iadlScore * 15); // IADLæ‰£åˆ†æƒé‡
            }
            if(mods['Lifestyle_PHQ2']) {
                const phqScore = mods['Lifestyle_PHQ2'].data.total_score;
                let alert = phqScore >= 3 ? `<span class="alert-text">æŠ‘éƒå‡æ€§ç—´å‘†é¢„è­¦</span>` : "";
                resHTML += `<div class="result-item"><span>ğŸŒ§ï¸ PHQ-2 æŠ‘éƒç­›æŸ¥ (â‰¥3åˆ†é˜³æ€§):</span> <strong>${phqScore} åˆ† ${alert}</strong></div>`;
                chartScores.LIF -= (phqScore * 10); // PHQæ‰£åˆ†æƒé‡
            }
            // ================= æ–°å¢ï¼šå½±åƒè¡€æµä¸æŒ‰é”®åŠ¨åŠ›å­¦è§£æ =================
            
            // ã€å½±åƒä¸è¡€æµåŠ¨åŠ›å­¦ PHYã€‘
            if(mods['PHY_Face_rPPG']) {
                const rppg = mods['PHY_Face_rPPG'].data;
                // æ­¤å¤„æç¤ºåŒ»ç”Ÿæ•°æ®å·²å°±ç»ªï¼Œç­‰å¾…åç«¯è§£ç®—
                resHTML += `<div class="result-item"><span>ğŸ¥ é¢éƒ¨å½±åƒ (å½•åˆ¶æ—¶é•¿ / è§†é¢‘åŒ…ä½“ç§¯):</span> <strong>${rppg.duration_sec}s / ${rppg.video_size_mb} MB <span style="font-size:12px;color:#64748b;">(å¾…Pythonåç«¯è§£ç®—HRV)</span></strong></div>`;
            }

            // ã€æŒ‰é”®åŠ¨åŠ›å­¦ KEY / MOTå­é›†ã€‘
            if(mods['MOT_Keystroke']) {
                const keystroke = mods['MOT_Keystroke'].data.summary;
                // ä¸´åºŠé˜ˆå€¼é¢„è­¦ï¼šDwell Time > 200ms æç¤ºä¸¥é‡çš„æŒ‰é”®ç²˜æ»ï¼ˆå¼ºç›´/è¿åŠ¨è¿Ÿç¼“ï¼‰
                let alert = keystroke.avg_dwell_ms > 200 ? `<span class="alert-text">âš ï¸ æ»ç•™å¼‚å¸¸(æç¤ºè¿åŠ¨è¿Ÿç¼“)</span>` : "";
                resHTML += `<div class="result-item"><span>âŒ¨ï¸ æŒ‰é”®åŠ¨åŠ›å­¦ (æ»ç•™ Dwell / é£è¡Œ Flight):</span> <strong>${keystroke.avg_dwell_ms} ms / ${keystroke.avg_flight_ms} ms ${alert}</strong></div>`;
                
                // å°†æŒ‰é”®æ»ç•™æ—¶é—´èå…¥ã€è¿åŠ¨ MOTã€‘ç»´åº¦çš„é›·è¾¾å›¾æƒ©ç½šè®¡åˆ†ä¸­
                // å‡è®¾æ­£å¸¸äºº Dwell ä¸º 100msï¼Œè¶…è¿‡éƒ¨åˆ†å°†æŒ‰æ¯”ä¾‹æ‰£é™¤ MOT åˆ†æ•°
                let dwellPenalty = Math.max(0, (keystroke.avg_dwell_ms - 100) / 2);
                chartScores.MOT = Math.max(0, chartScores.MOT - dwellPenalty);
            }

            // æ¸²æŸ“æå–çš„æ–‡å­—å†…å®¹
            if(resHTML !== '') document.getElementById('results-content').innerHTML = resHTML;

            // æ¸²æŸ“å¯è§†åŒ–å›¾è¡¨åŠ¨ç”»
            chartScores.LIF = Math.max(0, chartScores.LIF); // ä¿è¯åº•çº¿ä¸ä¸ºè´Ÿ
            setTimeout(() => {
                ['COG', 'EMO', 'MOT', 'SEN', 'LAN', 'LIF'].forEach(domain => {
                    let score = chartScores[domain];
                    document.getElementById(`bar-${domain.toLowerCase()}`).style.width = score + '%';
                    document.getElementById(`val-${domain.toLowerCase()}`).innerText = score;
                });
            }, 500);

            // 4. ç”Ÿæˆ JSON æºç é¢„è§ˆ
            session.end_time = new Date().toISOString();
            document.getElementById('json-code').value = JSON.stringify(session, null, 2);
        };

        function togglePreview() {
            const panel = document.getElementById('preview-panel');
            panel.style.display = panel.style.display === 'block' ? 'none' : 'block';
        }
    </script>
</body>
</html>
