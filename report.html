<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CAS å¤åˆæ•°å­—è¡¨å‹æ•°æ®ä¸­å¿ƒ</title>
    <style>
        body { font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif; background: #f8fafc; padding: 20px; color: #334155; }
        .container { max-width: 950px; margin: 20px auto; background: white; padding: 40px; border-radius: 16px; box-shadow: 0 4px 6px rgba(0,0,0,0.05); border-top: 5px solid #10b981; }
        h2 { color: #0f172a; margin-top: 0; font-size: 26px; }
        .session-info { font-family: monospace; background: #f1f5f9; padding: 10px 15px; border-radius: 8px; font-size: 16px; color: #475569; display: inline-block; margin-bottom: 20px; }
        
        /* é‡‡ç”¨3åˆ—å¸ƒå±€è‡ªé€‚åº” 15 ä¸ªæ¨¡å— */
        .status-board { background: #f8fafc; padding: 25px; border-radius: 12px; margin: 20px 0 30px 0; display: grid; grid-template-columns: repeat(auto-fit, minmax(260px, 1fr)); gap: 12px; border: 1px solid #e2e8f0; }
        .item { display: flex; justify-content: space-between; align-items: center; padding: 12px 15px; background: white; border-radius: 8px; font-size: 14px; box-shadow: 0 1px 3px rgba(0,0,0,0.05); border-left: 4px solid transparent; }
        .item.is-done { border-left-color: #10b981; }
        .item.is-pending { border-left-color: #f43f5e; }
        
        .done { color: #10b981; font-weight: bold; background: #d1fae5; padding: 4px 8px; border-radius: 4px; font-size: 12px; }
        .pending { color: #f43f5e; font-weight: bold; background: #ffe4e6; padding: 4px 8px; border-radius: 4px; font-size: 12px; }
        
        .btn-group { display: flex; flex-direction: column; gap: 15px; }
        .btn { display: block; width: 100%; padding: 20px; border: none; border-radius: 12px; font-size: 18px; font-weight: bold; cursor: pointer; text-align: center; text-decoration: none; color: white; transition: opacity 0.2s, transform 0.1s; }
        .btn:hover { opacity: 0.9; }
        .btn:active { transform: scale(0.99); }
        .btn-export { background: #10b981; box-shadow: 0 4px 15px rgba(16, 185, 129, 0.3); }
        .btn-preview { background: #64748b; }
        .btn-nav { background: #3b82f6; }
        .btn-danger { background: #f43f5e; }

        /* æ–°å¢ï¼šé¢„è§ˆä¸å¤åˆ¶é¢æ¿ UI */
        .preview-box { display: none; flex-direction: column; background: #1e293b; padding: 20px; border-radius: 12px; margin-top: 20px; animation: fadeIn 0.3s ease-in-out; }
        .preview-box textarea { width: 100%; height: 400px; background: #0f172a; color: #10b981; border: 1px solid #334155; border-radius: 8px; padding: 15px; font-family: 'Courier New', Courier, monospace; font-size: 14px; resize: vertical; outline: none; box-sizing: border-box; }
        .copy-action-btn { align-self: flex-end; margin-top: 15px; background: #3b82f6; color: white; padding: 12px 25px; border: none; border-radius: 8px; font-size: 16px; font-weight: bold; cursor: pointer; transition: 0.2s; }
        .copy-action-btn:hover { background: #2563eb; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(-10px); } to { opacity: 1; transform: translateY(0); } }
    </style>
    <script src="cas-storage.js"></script>
</head>
<body>
    <div class="container">
        <h2>ğŸ”¬ CAS å¤åˆæ•°å­—è¡¨å‹æ•°æ®ä¸­å¿ƒ</h2>
        <div class="session-info">Session ID: <span id="sess-id" style="font-weight:bold;">åŠ è½½ä¸­...</span></div>
        
        <div class="status-board" id="board">
            </div>

        <div class="btn-group">
            <button class="btn btn-export" onclick="CAS_Storage.exportJSON()">ğŸ“¥ ä¸€é”®å¯¼å‡ºå®Œæ•´é«˜ç»´ JSON æ•°æ®æ–‡ä»¶</button>
            <button class="btn btn-preview" onclick="togglePreview()">ğŸ‘€ å±•å¼€é¢„è§ˆå¹¶å¤åˆ¶åŸå§‹æ•°æ® (JSON)</button>
            
            <div class="preview-box" id="preview-container">
                <textarea id="json-output-text" readonly></textarea>
                <button class="copy-action-btn" id="copy-btn" onclick="copyJSON()">ğŸ“‹ å¤åˆ¶åˆ°å‰ªè´´æ¿</button>
            </div>

            <a href="index.html" class="btn btn-nav">â† è¿”å›æµ‹è¯•æ§åˆ¶å°ç»§ç»­è¡¥å……</a>
            <button class="btn btn-danger" onclick="CAS_Storage.clearSession()">âš ï¸ ç»“æŸå½“å‰è¯„ä¼°å¹¶æ¸…é™¤å—è¯•è€…ç¼“å­˜</button>
        </div>
    </div>

    <script>
        window.onload = function() {
            const session = CAS_Storage.getSession();
            document.getElementById('sess-id').innerText = session.session_id;
            
            // å®Œæ•´æ³¨å†Œ 15 ä¸ªä¸´åºŠçº§å­æ¨¡å—
            const modules = [
                { id: 'Cognition_Corsi', name: 'ğŸ§  å·¥ä½œè®°å¿† (Corsi)' },
                { id: 'Cognition_Stroop', name: 'ğŸ§  æ‰§è¡ŒæŠ‘åˆ¶ (Stroop)' },
                { id: 'Cognition_TMT_B', name: 'ğŸ§  è®¤çŸ¥æŸ”æ€§ (TMT)' },
                { id: 'Cognition_DSST', name: 'ğŸ§  å¤„ç†é€Ÿåº¦ (DSST)' },
                { id: 'Emotion_State_EMA', name: 'ğŸ“Š çŠ¶æ€è‡ªè¯„ (EMA)' },
                { id: 'Emotion_Trait_Big5', name: 'ğŸ“Š äººæ ¼ç‰¹è´¨ (Big5)' },
                { id: 'Emotion_Risk_BART', name: 'ğŸˆ é£é™©å†³ç­– (BART)' },
                { id: 'Emotion_Affective_Stroop', name: 'ğŸ’” æƒ…ç»ªæ³¨æ„ (E-Stroop)' },
                { id: 'Motor_SimpleTapping', name: 'ğŸ¯ å•æŒ‡æ•²å‡» (Tapping)' },
                { id: 'Motor_Fitts', name: 'ğŸ¯ é¶å‘è¿åŠ¨ (Fitts)' },
                { id: 'Motor_Spiral_Tracing', name: 'ğŸ¯ éœ‡é¢¤åˆ†æ (Spiral)' },
                { id: 'Sensation_SimpleRT', name: 'âš¡ ç®€å•ååº” (Simple RT)' },
                { id: 'Sensation_ChoiceRT', name: 'âš¡ å†³ç­–ååº” (Choice RT)' },
                { id: 'Sensation_GoNoGo', name: 'âš¡ æ„Ÿè§‰æŠ‘åˆ¶ (Go/No-Go)' },
                { id: 'Sensation_VisualSearch', name: 'âš¡ è§†è§‰æœç´¢ (V-Search)' }
            ];

            const board = document.getElementById('board');
            modules.forEach(m => {
                const isDone = session.modules.hasOwnProperty(m.id);
                const statusClass = isDone ? 'is-done' : 'is-pending';
                const badgeClass = isDone ? 'done' : 'pending';
                const badgeText = isDone ? 'âœ“ å·²é‡‡å½•' : 'å¾…å®Œæˆ';
                
                board.innerHTML += `
                    <div class="item ${statusClass}">
                        <span>${m.name}</span>
                        <span class="${badgeClass}">${badgeText}</span>
                    </div>`;
            });
        };

        // æ–°å¢ï¼šåˆ‡æ¢é¢„è§ˆé¢æ¿çš„å¯è§æ€§å¹¶æ³¨å…¥æœ€æ–°æ•°æ®
        function togglePreview() {
            const container = document.getElementById('preview-container');
            if (container.style.display === 'flex') {
                container.style.display = 'none';
            } else {
                const session = CAS_Storage.getSession();
                // ç¡®ä¿ç»“æŸæ—¶é—´è¢«è®°å½•ï¼ˆä¸å¯¼å‡ºé€»è¾‘ä¸€è‡´ï¼‰
                session.end_time = new Date().toISOString();
                document.getElementById('json-output-text').value = JSON.stringify(session, null, 2);
                container.style.display = 'flex';
                // è‡ªåŠ¨æ»šåŠ¨åˆ°é¢„è§ˆåŒºåŸŸ
                container.scrollIntoView({ behavior: 'smooth', block: 'nearest' });
            }
        }

        // æ–°å¢ï¼šä¸€é”®å¤åˆ¶åŠŸèƒ½ (å…¼å®¹ç§»åŠ¨ç«¯ä¸ PC ç«¯)
        function copyJSON() {
            const textArea = document.getElementById('json-output-text');
            const btn = document.getElementById('copy-btn');
            
            textArea.select();
            textArea.setSelectionRange(0, 999999); // é€‚é…ç§»åŠ¨ç«¯ Safari

            navigator.clipboard.writeText(textArea.value).then(() => {
                btn.innerText = "âœ“ å·²æˆåŠŸå¤åˆ¶åˆ°å‰ªè´´æ¿ï¼";
                btn.style.background = "#10b981"; // å˜ä¸ºæˆåŠŸç»¿
                
                setTimeout(() => {
                    btn.innerText = "ğŸ“‹ å¤åˆ¶åˆ°å‰ªè´´æ¿";
                    btn.style.background = "#3b82f6"; // æ¢å¤åŸå§‹è“
                }, 2500);
            }).catch(err => {
                alert("å¤åˆ¶å¤±è´¥ï¼Œè¯·æ‰‹åŠ¨é•¿å®‰å…¨é€‰æ¡†å†…æ–‡æœ¬ã€‚");
            });
        }
    </script>
</body>
</html>
