<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>CAS-LAN | è¯­è¨€åŠŸèƒ½ä¸è¯­ä¹‰ç½‘ç»œ</title>
    <style>
        body { 
            font-family: -apple-system, sans-serif; 
            background: #f8fafc; 
            margin: 0; 
            padding: 20px; 
            text-align: center; 
        }
        .container { 
            max-width: 650px; 
            margin: 20px auto; 
            background: white; 
            padding: 35px 30px; 
            border-radius: 20px; 
            box-shadow: 0 10px 25px rgba(0,0,0,0.05); 
        }
        .module-header { 
            color: #0f172a; 
            margin-top: 0; 
            font-size: 24px; 
            border-bottom: 2px solid #e2e8f0; 
            padding-bottom: 15px; 
            margin-bottom: 25px; 
        }
        .sys-btn { 
            background: #0f172a; 
            color: white; 
            border: none; 
            padding: 18px 30px; 
            font-size: 16px; 
            font-weight: bold; 
            border-radius: 12px; 
            cursor: pointer; 
            margin: 10px 0; 
            width: 100%; 
            transition: 0.2s; 
            box-shadow: 0 4px 10px rgba(0,0,0,0.1); 
        }
        .sys-btn:active { transform: scale(0.98); } 
        .hidden { display: none !important; }
        
        #nav-back { 
            display: inline-flex; 
            align-items: center; 
            text-decoration: none; 
            color: #3b82f6; 
            font-weight: bold; 
            margin-bottom: 15px; 
            padding: 10px 18px; 
            background: #eff6ff; 
            border-radius: 10px; 
            transition: 0.2s; 
        } 
        #nav-back:active { background: #dbeafe; }
        
        /* è¾“å…¥æ¡†æ ·å¼ */
        #vft-input, #naming-input { 
            width: 70%; 
            padding: 18px; 
            font-size: 18px; 
            border: 2px solid #cbd5e1; 
            border-radius: 12px; 
            margin-right: 15px; 
            outline: none; 
            transition: 0.2s; 
            box-sizing: border-box; 
            background: #f8fafc; 
        } 
        #vft-input:focus, #naming-input:focus { 
            border-color: #3b82f6; 
            background: white; 
        }
        
        /* VFT è¯æ±‡äº‘æ ‡ç­¾ */
        .vft-word-list { 
            display: flex; 
            flex-wrap: wrap; 
            gap: 10px; 
            justify-content: center; 
            margin-top: 30px; 
        } 
        .vft-tag { 
            background: #e0f2fe; 
            color: #0369a1; 
            padding: 10px 18px; 
            border-radius: 20px; 
            font-weight: bold; 
            font-size: 15px; 
            box-shadow: 0 2px 4px rgba(0,0,0,0.05); 
        }
        
        /* å‘½åå›¾ç‰‡æ ·å¼ */
        #naming-pic { 
            font-size: 120px; 
            margin: 40px 0; 
        }
    </style>
    <script src="cas-storage.js"></script>
</head>
<body>
    <div style="text-align: left; max-width: 650px; margin: 0 auto;">
        <a href="index.html" id="nav-back">â† è¿”å›æ§åˆ¶å°</a>
    </div>
    
    <div class="container" id="menu">
        <h2 class="module-header">ğŸ’¬ è¯­è¨€ä¸è¯­ä¹‰ç½‘ç»œ</h2>
        <button class="sys-btn" onclick="show('vft-area'); startVFT();">1. è¯æ±‡æµç•…æ€§æå– (VFT - åŠ¨ç‰©ç±»)</button>
        <button class="sys-btn" style="background:#3b82f6;" onclick="show('naming-area'); startNaming();">2. æ•°å­—åŒ–å›¾ç‰‡å‘½åæ—¶å»¶ (Naming)</button>
    </div>

    <div class="container hidden" id="vft-area">
        <h2 class="module-header">è¯æ±‡æµç•…æ€§ (VFT)</h2>
        <p style="color:#ef4444; font-weight:bold; font-size:24px; margin-bottom: 5px;" id="vft-timer">å‰©ä½™: 60 s</p>
        <p style="color:#64748b; margin-bottom: 25px;">è¯·åœ¨ 60 ç§’å†…ï¼Œè¾“å…¥å°½å¯èƒ½å¤šçš„<strong>åŠ¨ç‰©åç§°</strong>ã€‚è¾“å…¥åç‚¹å‡»æäº¤æˆ–æŒ‰å›è½¦ã€‚</p>
        
        <div style="display: flex; justify-content: center; align-items: center;">
            <input type="text" id="vft-input" placeholder="ä¾‹å¦‚ï¼šå¤§è±¡" autocomplete="off">
            <button class="sys-btn" style="width:auto; margin:0; padding:18px 25px;" onclick="submitVFTWord()">è¾“å…¥</button>
        </div>
        
        <div class="vft-word-list" id="vft-list"></div>
    </div>

    <div class="container hidden" id="naming-area">
        <h2 class="module-header">å›¾ç‰‡å‘½åæ—¶å»¶</h2>
        <p style="color:#64748b;">è¯·ä»¥æœ€å¿«é€Ÿåº¦åœ¨æ¡†å†…å†™å‡ºä¸‹æ–¹ç‰©å“çš„åç§°ã€‚</p>
        
        <div id="naming-pic">ğŸ«</div>
        
        <div style="display: flex; justify-content: center; margin-bottom: 25px;">
            <input type="text" id="naming-input" placeholder="è¾“å…¥åç§°å¹¶å›è½¦...">
            <button class="sys-btn" style="width:auto; margin:0; padding:18px 25px;" onclick="submitNaming()">ç¡®è®¤</button>
        </div>
        
        <p id="naming-progress" style="font-weight:bold; color:#0f172a;">è¿›åº¦: 1 / 3</p>
    </div>

    <script>
        function show(id) { 
            ['menu', 'vft-area', 'naming-area'].forEach(d => {
                document.getElementById(d).classList.add('hidden');
            }); 
            document.getElementById(id).classList.remove('hidden'); 
        }

        /* ==================== 1. VFT é€»è¾‘ ==================== */
        let vftData = { module: "Language_VFT", category: "Animals", total_words: 0, words_array: [] };
        let vftTime = 60, vftTimerId, vftStartTime = 0;

        function startVFT() { 
            vftData.words_array = []; 
            document.getElementById('vft-list').innerHTML = ''; 
            document.getElementById('vft-input').value = ''; 
            vftTime = 60; 
            vftStartTime = performance.now(); 
            
            // è‡ªåŠ¨èšç„¦è¾“å…¥æ¡†
            document.getElementById('vft-input').focus(); 
            
            vftTimerId = setInterval(() => { 
                vftTime--; 
                document.getElementById('vft-timer').innerText = `å‰©ä½™: ${vftTime} s`; 
                if(vftTime <= 0) finishVFT(); 
            }, 1000); 
            
            // ç›‘å¬å›è½¦é”® (å¤„ç†ä¸­æ–‡è¾“å…¥æ³•ç»„åˆé”®çš„æƒ…å†µ)
            document.getElementById('vft-input').addEventListener('keyup', function(e) { 
                if (e.key === 'Enter' && !e.isComposing) submitVFTWord(); 
            }); 
        }

        function submitVFTWord() { 
            if(vftTime <= 0) return; 
            
            let input = document.getElementById('vft-input'); 
            let word = input.value.trim(); 
            
            if(word) { 
                // è®¡ç®—è¯¥è¯æ±‡è·ç¦»æµ‹è¯•å¼€å§‹çš„æ—¶é—´æˆ³ (ITI åˆ†æåŸºç¡€)
                let rt = performance.now() - vftStartTime; 
                vftData.words_array.push({ word: word, timestamp_ms: Math.round(rt) }); 
                
                // æ¸²æŸ“è§†è§‰æ ‡ç­¾
                let tag = document.createElement('div'); 
                tag.className = 'vft-tag'; 
                tag.innerText = word; 
                document.getElementById('vft-list').appendChild(tag); 
                
                input.value = ''; 
            } 
        }

        function finishVFT() { 
            clearInterval(vftTimerId); 
            vftData.total_words = vftData.words_array.length; 
            CAS_Storage.saveModuleData('Language_VFT', vftData); 
            alert(`VFT æµ‹è¯•ç»“æŸã€‚å…±ç”Ÿæˆ ${vftData.total_words} ä¸ªè¯æ±‡ã€‚`); 
            show('menu'); 
        }
        
        /* ==================== 2. Naming é€»è¾‘ ==================== */
        const namingStimuli = [ 
            { pic: 'ğŸ«', ans: ['éª†é©¼'] }, 
            { pic: 'ğŸ¦', ans: ['çŠ€ç‰›'] }, 
            { pic: 'ğŸ›¶', ans: ['ç‹¬æœ¨èˆŸ', 'èˆ¹', 'å°èˆ¹'] } 
        ]; 
        let nData = { module: "Language_Naming", records: [] };
        let nTr = 0, nOnset = 0;

        function startNaming() { 
            nTr = 0; 
            nData.records = []; 
            nextNaming(); 
        }

        function nextNaming() { 
            if(nTr >= namingStimuli.length) { 
                CAS_Storage.saveModuleData('Language_Naming', nData); 
                alert("å‘½åæµ‹è¯•ç‰¹å¾å…¥åº“"); 
                show('menu'); 
                return; 
            } 
            
            document.getElementById('naming-pic').innerText = namingStimuli[nTr].pic; 
            document.getElementById('naming-input').value = ''; 
            document.getElementById('naming-progress').innerText = `è¿›åº¦: ${nTr+1} / ${namingStimuli.length}`; 
            
            setTimeout(() => document.getElementById('naming-input').focus(), 100); 
            
            nOnset = performance.now(); 
            
            // ç›‘å¬å›è½¦é”®
            document.getElementById('naming-input').onkeyup = function(e) { 
                if(e.key === 'Enter' && !e.isComposing) submitNaming(); 
            }; 
        }

        function submitNaming() { 
            let val = document.getElementById('naming-input').value.trim(); 
            if(!val) return; 
            
            let rt = performance.now() - nOnset; 
            // ç®€å•çš„åŒ…å«åŒ¹é…ä»¥å®¹é”™
            let isCorrect = namingStimuli[nTr].ans.some(a => val.includes(a)); 
            
            nData.records.push({ 
                item: namingStimuli[nTr].pic, 
                user_input: val, 
                correct: isCorrect, 
                rt_ms: Math.round(rt) 
            }); 
            
            nTr++; 
            nextNaming(); 
        }
    </script>
</body>
</html>
