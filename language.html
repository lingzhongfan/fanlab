<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <title>CAS-LAN | è¯­è¨€åŠŸèƒ½</title>
    <style>
        /* ç»§æ‰¿ç»Ÿä¸€ UI */
        body { font-family: sans-serif; background: #fcfcfd; margin: 0; padding: 20px; color: #334155; }
        .container { max-width: 650px; margin: 20px auto; background: white; padding: 40px; border-radius: 24px; box-shadow: 0 10px 30px rgba(0,0,0,0.03); border: 1px solid #f1f5f9; }
        .hidden { display: none !important; }
        .sys-btn { width: 100%; padding: 18px; margin-bottom: 15px; border: none; border-radius: 16px; cursor: pointer; font-weight: bold; font-size: 16px; background: #eef2ff; color: #4f46e5; transition: 0.2s; }
        .btn-action { background: #4f46e5; color: white; }
        
        /* è¯­éŸ³è¾“å…¥æ¡†æ ·å¼ */
        .input-wrapper { display: flex; gap: 10px; margin: 20px 0; }
        input[type="text"] { flex: 1; padding: 15px; border: 2px solid #e2e8f0; border-radius: 14px; font-size: 18px; }
        .btn-mic { background: #10b981; color: white; border: none; border-radius: 14px; padding: 0 25px; font-size: 24px; cursor: pointer; transition: 0.2s; }
        .btn-mic:active { transform: scale(0.9); }
        .recording { animation: pulse 1.5s infinite; background: #f43f5e; }
        @keyframes pulse { 0% { box-shadow: 0 0 0 0 rgba(244, 63, 94, 0.4); } 70% { box-shadow: 0 0 0 15px rgba(244, 63, 94, 0); } 100% { box-shadow: 0 0 0 0 rgba(244, 63, 94, 0); } }
    </style>
    <script src="cas-storage.js"></script>
</head>
<body>
    <button onclick="location.href='index.html'" style="background:none; border:none; color:#4f46e5; font-weight:bold; cursor:pointer; font-size: 16px;">â† è¿”å›æ§åˆ¶å°</button>

    <div class="container" id="menu">
        <h2 style="color: #1e293b; margin-top:0;">ğŸ’¬ è¯­è¨€æå–ä¸è¯­ä¹‰ç½‘ç»œ</h2>
        <button class="sys-btn" onclick="show('vft-area'); startVFT();">1. è¯æ±‡æµç•…æ€§æå– (VFT) - æ”¯æŒè¯­éŸ³</button>
        <button class="sys-btn" onclick="show('sema-area');">2. è¯­ä¹‰å…³è”ä¸æŠ½è±¡æå–</button>
    </div>

    <div class="container hidden" id="vft-area">
        <h2>è¯æ±‡æµç•…æ€§ (åŠ¨ç‰©ç±»)</h2>
        <p style="color:red; font-size:24px; font-weight:bold; text-align:center;" id="vft-timer">60s</p>
        <p style="color:#64748b; text-align:center;">è¯·è¯´å‡ºå°½å¯èƒ½å¤šçš„åŠ¨ç‰©åç§°ï¼ˆç‚¹å‡»éº¦å…‹é£è¯´è¯ï¼‰ã€‚</p>
        
        <div class="input-wrapper">
            <input type="text" id="vft-input" placeholder="è¾“å…¥æˆ–è¯­éŸ³è¾“å…¥...">
            <button class="btn-mic" id="mic-btn" onclick="startVoice('vft-input')">ğŸ¤</button>
        </div>
        <button class="sys-btn btn-action" onclick="submitVFT()">å½•å…¥è¯¥è¯ (+)</button>
        
        <div id="vft-list" style="display:flex; flex-wrap:wrap; gap:10px; margin-top:20px;"></div>
    </div>

    <div class="container hidden" id="sema-area">
        <h2>é«˜é˜¶è¯­ä¹‰åˆ¤åˆ«</h2>
        <p style="text-align:center; color:#64748b;">è¯·é€‰æ‹©ä¸ä¸‹æ–¹è¯æ±‡åŒå±ä¸€ç±»æˆ–å…³è”æœ€ç´§å¯†çš„è¯æ±‡ï¼š</p>
        <h1 style="text-align:center; color:#1e293b; font-size: 40px; margin: 40px 0;">ç«è½¦</h1>
        <div style="display:flex; flex-direction:column; gap:15px;">
            <button class="sys-btn" style="background:#f1f5f9; color:#1e293b; border:1px solid #cbd5e1;" onclick="alert('å·²è®°å½•'); show('menu');">A. è‡ªè¡Œè½¦</button>
            <button class="sys-btn" style="background:#f1f5f9; color:#1e293b; border:1px solid #cbd5e1;" onclick="alert('å·²è®°å½•'); show('menu');">B. è‹¹æœ</button>
            <button class="sys-btn" style="background:#f1f5f9; color:#1e293b; border:1px solid #cbd5e1;" onclick="alert('å·²è®°å½•'); show('menu');">C. æ¡Œå­</button>
        </div>
    </div>

    <script>
        function show(id) {
            ['menu', 'vft-area', 'sema-area'].forEach(d => document.getElementById(d).classList.add('hidden'));
            document.getElementById(id).classList.remove('hidden');
        }

        // è¯­éŸ³è¯†åˆ«åˆå§‹åŒ– (ä»…åœ¨æµè§ˆå™¨æ”¯æŒæ—¶ç”Ÿæ•ˆ)
        const SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;
        let recognition;
        if (SpeechRecognition) {
            recognition = new SpeechRecognition();
            recognition.lang = 'zh-CN';
            recognition.interimResults = false;
        }

        function startVoice(targetId) {
            if (!recognition) return alert("æ‚¨çš„æµè§ˆå™¨ä¸æ”¯æŒè¯­éŸ³è¾“å…¥ï¼Œè¯·æ‰‹åŠ¨è¾“å…¥æˆ–ä½¿ç”¨Chromeæµè§ˆå™¨ã€‚");
            const btn = document.getElementById('mic-btn');
            btn.classList.add('recording');
            recognition.start();
            
            recognition.onresult = function(event) {
                const text = event.results[0][0].transcript.replace(/[ã€‚ï¼Œï¼ï¼Ÿ]/g, ''); // å»é™¤æ ‡ç‚¹
                document.getElementById(targetId).value = text;
                btn.classList.remove('recording');
            };
            recognition.onerror = function() { btn.classList.remove('recording'); };
            recognition.onend = function() { btn.classList.remove('recording'); };
        }

        // VFT é€»è¾‘
        let vftData = { words: [] }, vftTimerId, time = 60;
        function startVFT() {
            time = 60; vftData.words = []; document.getElementById('vft-list').innerHTML = '';
            vftTimerId = setInterval(() => {
                time--; document.getElementById('vft-timer').innerText = time + 's';
                if(time <= 0) { clearInterval(vftTimerId); CAS_Storage.saveModuleData('Language_VFT', vftData); alert("æ—¶é—´åˆ°ï¼è®°å½•å·²ä¿å­˜"); show('menu'); }
            }, 1000);
        }
        function submitVFT() {
            const input = document.getElementById('vft-input');
            const word = input.value.trim();
            if(word) {
                vftData.words.push(word);
                const tag = document.createElement('span');
                tag.style.cssText = "background:#eef2ff; color:#4f46e5; padding:8px 15px; border-radius:20px; font-weight:bold;";
                tag.innerText = word;
                document.getElementById('vft-list').appendChild(tag);
                input.value = '';
            }
        }
    </script>
</body>
</html>
