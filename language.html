<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>è¯­è¨€ä¸è¨€è¯­åŠŸèƒ½è¯„ä¼°</title>
    <style>
        body { font-family: -apple-system, sans-serif; background: #f8fafc; margin: 0; padding: 20px; text-align: center; }
        .container { max-width: 650px; margin: 20px auto; background: white; padding: 30px; border-radius: 16px; box-shadow: 0 4px 6px rgba(0,0,0,0.05); }
        .sys-btn { background: #0f172a; color: white; border: none; padding: 15px 30px; font-size: 16px; border-radius: 8px; cursor: pointer; margin: 10px 0; width: 100%; transition: 0.1s; }
        .sys-btn:active { background: #334155; }
        .hidden { display: none !important; }
        #nav-back { display: block; text-align: left; text-decoration: none; color: #3b82f6; font-weight: bold; margin-bottom: 10px; }
        
        /* VFT UI */
        #vft-input { width: 70%; padding: 15px; font-size: 18px; border: 2px solid #cbd5e1; border-radius: 8px; margin-right: 10px; outline: none; }
        #vft-input:focus { border-color: #3b82f6; }
        .vft-word-list { display: flex; flex-wrap: wrap; gap: 10px; justify-content: center; margin-top: 20px; }
        .vft-tag { background: #e0f2fe; color: #0369a1; padding: 8px 15px; border-radius: 20px; font-weight: bold; animation: fadeIn 0.3s; }
        
        /* Naming UI */
        #naming-pic { font-size: 100px; margin: 30px 0; }
        
        @keyframes fadeIn { from { opacity: 0; transform: scale(0.9); } to { opacity: 1; transform: scale(1); } }
    </style>
    <script src="cas-storage.js"></script>
</head>
<body>
    <a href="index.html" id="nav-back">â† è¿”å›ä¸»æ§å°</a>
    <div class="container" id="menu">
        <h2>è¯­è¨€ä¸è¯­ä¹‰ç½‘ç»œè¯„ä¼° (Language)</h2>
        <p style="color:#64748b; font-size:14px;">è¯„ä¼°è¯æ±‡æå–é€Ÿåº¦ä¸è¯­ä¹‰ç½‘ç»œçš„å®Œæ•´æ€§ã€‚</p>
        <button class="sys-btn" onclick="show('vft-area'); startVFT();">1. è¯æ±‡æµç•…æ€§æµ‹è¯• (VFT - åŠ¨ç‰©ç±»)</button>
        <button class="sys-btn" style="background:#3b82f6;" onclick="show('naming-area'); startNaming();">2. æ•°å­—åŒ–å›¾ç‰‡å‘½åæµ‹è¯• (Naming)</button>
    </div>

    <div class="container hidden" id="vft-area">
        <h3>è¯æ±‡æµç•…æ€§ (VFT)</h3>
        <p style="color:#ef4444; font-weight:bold; font-size:20px;" id="vft-timer">å‰©ä½™: 60 s</p>
        <p style="color:#64748b; margin-bottom: 20px;">è¯·åœ¨ 60 ç§’å†…ï¼Œè¾“å…¥å°½å¯èƒ½å¤šçš„<strong>åŠ¨ç‰©åç§°</strong>ã€‚è¾“å…¥ä¸€ä¸ªåç‚¹å‡»æäº¤æˆ–æŒ‰å›è½¦ã€‚</p>
        
        <div style="display: flex; justify-content: center;">
            <input type="text" id="vft-input" placeholder="ä¾‹å¦‚ï¼šå¤§è±¡" autocomplete="off">
            <button class="sys-btn" style="width:auto; margin:0;" onclick="submitVFTWord()">æäº¤</button>
        </div>
        <div class="vft-word-list" id="vft-list"></div>
    </div>

    <div class="container hidden" id="naming-area">
        <h3>å›¾ç‰‡å‘½åæµ‹è¯•</h3>
        <p style="color:#64748b;">è¯·ä»¥æœ€å¿«é€Ÿåº¦å†™å‡ºä¸‹æ–¹å›¾åƒçš„åç§°ã€‚</p>
        <div id="naming-pic">ğŸ«</div>
        <div style="display: flex; justify-content: center; margin-bottom: 20px;">
            <input type="text" id="naming-input" style="width: 60%; padding: 15px; font-size: 18px; border: 2px solid #cbd5e1; border-radius: 8px;" placeholder="è¾“å…¥åç§°...">
            <button class="sys-btn" style="width:auto; margin:0; margin-left: 10px;" onclick="submitNaming()">ç¡®è®¤</button>
        </div>
        <p id="naming-progress">è¿›åº¦: 1 / 3</p>
    </div>

    <script>
        function show(id) { 
            ['menu', 'vft-area', 'naming-area'].forEach(div => document.getElementById(div).classList.add('hidden'));
            document.getElementById(id).classList.remove('hidden'); 
        }

        // --- 1. VFT ---
        let vftData = { module: "Language_VFT", category: "Animals", total_words: 0, words_array: [] };
        let vftTime = 60, vftTimerId, vftStartTime = 0;
        
        function startVFT() {
            vftData.words_array = []; document.getElementById('vft-list').innerHTML = '';
            document.getElementById('vft-input').value = ''; vftTime = 60;
            vftStartTime = performance.now();
            vftTimerId = setInterval(() => {
                vftTime--; document.getElementById('vft-timer').innerText = `å‰©ä½™: ${vftTime} s`;
                if(vftTime <= 0) finishVFT();
            }, 1000);
            
            // ç›‘å¬å›è½¦é”® (æ³¨æ„å¤„ç†ä¸­æ–‡è¾“å…¥æ³•çš„ç»„åˆçŠ¶æ€)
            document.getElementById('vft-input').addEventListener('keyup', function(e) {
                if (e.key === 'Enter' && !e.isComposing) submitVFTWord();
            });
        }
        
        function submitVFTWord() {
            if(vftTime <= 0) return;
            let input = document.getElementById('vft-input');
            let word = input.value.trim();
            if(word) {
                let rt = performance.now() - vftStartTime;
                vftData.words_array.push({ word: word, timestamp_ms: Math.round(rt) });
                let tag = document.createElement('div'); tag.className = 'vft-tag'; tag.innerText = word;
                document.getElementById('vft-list').appendChild(tag);
                input.value = '';
            }
        }
        
        function finishVFT() {
            clearInterval(vftTimerId); vftData.total_words = vftData.words_array.length;
            CAS_Storage.saveModuleData('Language_VFT', vftData);
            alert(`VFT æ—¶é—´åˆ°ï¼å…±ç”Ÿæˆ ${vftData.total_words} ä¸ªè¯æ±‡ã€‚`); show('menu');
        }

        // --- 2. Naming ---
        const namingStimuli = [ { pic: 'ğŸ«', ans: ['éª†é©¼'] }, { pic: 'ğŸ¦', ans: ['çŠ€ç‰›'] }, { pic: 'ğŸ›¶', ans: ['ç‹¬æœ¨èˆŸ', 'èˆ¹', 'å°èˆ¹'] } ];
        let nData = { module: "Language_Naming", records: [] }, nTr = 0, nOnset = 0;
        
        function startNaming() { nTr = 0; nData.records = []; nextNaming(); }
        function nextNaming() {
            if(nTr >= namingStimuli.length) { CAS_Storage.saveModuleData('Language_Naming', nData); alert("å‘½åæµ‹è¯•å®Œæˆ"); show('menu'); return; }
            document.getElementById('naming-pic').innerText = namingStimuli[nTr].pic;
            document.getElementById('naming-input').value = '';
            document.getElementById('naming-progress').innerText = `è¿›åº¦: ${nTr+1} / ${namingStimuli.length}`;
            nOnset = performance.now();
            
            document.getElementById('naming-input').onkeyup = function(e) {
                if(e.key === 'Enter' && !e.isComposing) submitNaming();
            };
        }
        function submitNaming() {
            let val = document.getElementById('naming-input').value.trim();
            if(!val) return;
            let rt = performance.now() - nOnset;
            let isCorrect = namingStimuli[nTr].ans.some(a => val.includes(a)); // ç®€å•åŒ…å®¹åŒ¹é…
            nData.records.push({ item: namingStimuli[nTr].pic, user_input: val, correct: isCorrect, rt_ms: Math.round(rt) });
            nTr++; nextNaming();
        }
    </script>
</body>
</html>
