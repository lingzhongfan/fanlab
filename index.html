<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>CAS - è®¡ç®—ç¥ç»å¿ƒç†ä¸æ•°å­—è¡¨å‹è¯„ä¼°ç³»ç»Ÿ</title>
    <style>
        :root { --primary-dark: #0f172a; --primary-blue: #3b82f6; --bg-color: #f8fafc; --text-main: #334155; --text-muted: #64748b; }
        body { font-family: -apple-system, sans-serif; background: var(--bg-color); color: var(--text-main); margin: 0; padding: 20px; }
        
        header { text-align: center; margin-bottom: 25px; padding: 30px 20px; background: white; border-radius: 16px; box-shadow: 0 4px 20px rgba(0,0,0,0.03); border-top: 6px solid var(--primary-dark); }
        header h1 { margin: 0 0 10px 0; font-size: 26px; color: var(--primary-dark); }
        header p { margin: 0; font-size: 15px; color: var(--text-muted); }
        .eng-title { font-family: monospace; color: var(--primary-blue); font-size: 13px; margin-top: 8px; display: block; }

        /* ========= å—è¯•è€…ä¿¡æ¯å»ºæ¡£è¡¨å• UI ========= */
        #setup-container { max-width: 650px; margin: 40px auto; background: white; padding: 40px; border-radius: 16px; box-shadow: 0 10px 25px rgba(0,0,0,0.05); border: 1px solid #e2e8f0; }
        #setup-container h2 { margin-top: 0; color: var(--primary-dark); display: flex; align-items: center; gap: 10px; border-bottom: 2px solid #e2e8f0; padding-bottom: 15px; margin-bottom: 25px; }
        .form-row { display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin-bottom: 20px; }
        .form-group { display: flex; flex-direction: column; }
        .form-group label { font-weight: bold; font-size: 14px; margin-bottom: 8px; color: #1e293b; }
        .form-group label span { color: #ef4444; margin-left: 4px; } /* å¿…å¡«çº¢æ˜Ÿ */
        .form-group input, .form-group select { padding: 12px 15px; border: 2px solid #cbd5e1; border-radius: 8px; font-size: 15px; outline: none; transition: border-color 0.2s; background: #f8fafc; }
        .form-group input:focus, .form-group select:focus { border-color: var(--primary-blue); background: white; }
        .submit-btn { width: 100%; padding: 18px; background: var(--primary-blue); color: white; border: none; border-radius: 10px; font-size: 18px; font-weight: bold; cursor: pointer; margin-top: 20px; transition: 0.2s; box-shadow: 0 4px 15px rgba(59, 130, 246, 0.3); }
        .submit-btn:hover { background: #2563eb; transform: translateY(-2px); }
        
        /* ========= æµ‹è¯•ä»ªè¡¨ç›˜ UI (é»˜è®¤éšè—) ========= */
        #dashboard-container { display: none; }
        .subj-badge { max-width: 1200px; margin: 0 auto 25px auto; padding: 15px 20px; background: #e0f2fe; color: #0369a1; border-radius: 12px; display: flex; justify-content: space-between; align-items: center; font-weight: bold; font-size: 15px; border: 1px solid #bae6fd; }
        
        .grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(350px, 1fr)); gap: 20px; max-width: 1200px; margin: 0 auto; }
        .card { background: white; padding: 25px; border-radius: 16px; box-shadow: 0 4px 15px rgba(0,0,0,0.03); text-decoration: none; color: inherit; border: 2px solid transparent; transition: all 0.2s; display: flex; flex-direction: column; }
        .card:hover { transform: translateY(-5px); border-color: var(--primary-blue); box-shadow: 0 12px 20px rgba(59, 130, 246, 0.1); }
        .card-header { display: flex; align-items: center; gap: 15px; margin-bottom: 10px; }
        .icon { font-size: 40px; }
        .card h2 { color: var(--primary-dark); margin: 0; font-size: 20px; }
        .domain-desc { font-size: 13px; color: #94a3b8; margin: 0 0 15px 0; padding-bottom: 15px; border-bottom: 1px solid #e2e8f0; line-height: 1.5; }
        .sub-test-list { list-style: none; padding: 0; margin: 0; flex-grow: 1; }
        .sub-test-list li { font-size: 14px; color: var(--text-main); margin-bottom: 12px; display: flex; align-items: center; font-weight: 500; }
        .sub-test-list li::before { content: "â€¢"; color: var(--primary-blue); font-weight: bold; font-size: 20px; margin-right: 10px; }
        
        .data-btn { display: flex; justify-content: center; align-items: center; gap: 10px; max-width: 1200px; margin: 35px auto; padding: 22px; background: var(--primary-blue); color: white; border-radius: 12px; text-decoration: none; font-size: 18px; font-weight: bold; box-shadow: 0 4px 15px rgba(59, 130, 246, 0.3); transition: background 0.2s; }
        .data-btn:hover { background: #2563eb; }
    </style>
    <script src="cas-storage.js"></script>
</head>
<body>
    <header>
        <h1>è®¡ç®—ç¥ç»å¿ƒç†ä¸æ•°å­—è¡¨å‹è¯„ä¼°ç³»ç»Ÿ (CAS)</h1>
        <p>æ”¯æŒå¤šæ¨¡æ€é«˜ç»´ç‰¹å¾æå–çš„ä¸´åºŠçº§è®¤çŸ¥è¯„ä¼°ç»„åˆ</p>
        <span class="eng-title">Computational Assessment Suite for Digital Phenotyping</span>
    </header>

    <div id="setup-container">
        <h2>ğŸ“ å—è¯•è€…å»ºæ¡£ (Subject Registration)</h2>
        <div class="form-row">
            <div class="form-group">
                <label>è¢«è¯•ç¼–å· (ID) <span>*</span></label>
                <input type="text" id="subj-id" placeholder="ä¾‹å¦‚ï¼šCAS_001">
            </div>
            <div class="form-group">
                <label>å§“åæ‹¼éŸ³/ç¼©å†™ <span>*</span></label>
                <input type="text" id="subj-name" placeholder="ä¾‹å¦‚ï¼šZhangSan">
            </div>
        </div>
        <div class="form-row">
            <div class="form-group">
                <label>å‡ºç”Ÿå¹´æœˆæ—¥ <span>*</span></label>
                <input type="date" id="subj-dob">
            </div>
            <div class="form-group">
                <label>æ€§åˆ« <span>*</span></label>
                <select id="subj-gender">
                    <option value="">è¯·é€‰æ‹©...</option>
                    <option value="Male">ç”· (Male)</option>
                    <option value="Female">å¥³ (Female)</option>
                    <option value="Other">å…¶ä»– (Other)</option>
                </select>
            </div>
        </div>
        <div class="form-row">
            <div class="form-group">
                <label>åˆ©æ‰‹ (Handedness) <span>*</span></label>
                <select id="subj-hand">
                    <option value="">è¯·é€‰æ‹©...</option>
                    <option value="Right">å³æ‰‹ (Right-handed)</option>
                    <option value="Left">å·¦æ‰‹ (Left-handed)</option>
                    <option value="Ambidextrous">åŒåˆ©æ‰‹ (Ambidextrous)</option>
                </select>
            </div>
            <div class="form-group">
                <label>å—æ•™è‚²å¹´é™ (Years of Edu)</label>
                <input type="number" id="subj-edu" placeholder="ä¾‹å¦‚ï¼š16" min="0" max="30">
            </div>
        </div>
        <button class="submit-btn" onclick="registerSubject()">âœ“ ä¿å­˜ä¿¡æ¯å¹¶å¼€å¯æµ‹è¯•ä¼šè¯</button>
    </div>

    <div id="dashboard-container">
        <div class="subj-badge">
            <span>å½“å‰å—è¯•è€…: <span id="display-subj-name" style="color:#0f172a; margin-right:15px;"></span> ID: <span id="display-subj-id" style="color:#0f172a; font-family:monospace;"></span></span>
            <button onclick="CAS_Storage.clearSession()" style="background:transparent; border:1px solid #0369a1; color:#0369a1; padding:5px 10px; border-radius:6px; cursor:pointer;">ç»“æŸä¼šè¯</button>
        </div>

        <div class="grid">
            <a href="cognition.html" class="card">
                <div class="card-header"><div class="icon">ğŸ§ </div><h2>è®¤çŸ¥ (CAS-COG)</h2></div>
                <p class="domain-desc">é¶å‘é¢å¶ä¸æµ·é©¬ä½“ç½‘ç»œï¼Œè¯„ä¼°æ‰§è¡Œæ§åˆ¶ã€å·¥ä½œè®°å¿†å¹¿åº¦ã€è®¤çŸ¥æŸ”æ€§åŠä¿¡æ¯å¤„ç†é€Ÿåº¦ï¼Œå¯¹æ—©æœŸè½»åº¦è®¤çŸ¥éšœç¢æå…·æ•æ„Ÿæ€§ã€‚</p>
                <ul class="sub-test-list"><li>Corsi ç©ºé—´å·¥ä½œè®°å¿†</li><li>Stroop æ‰§è¡Œæ§åˆ¶ä¸æŠ‘åˆ¶</li><li>TMT-B è¿çº¿æµ‹è¯• (è®¤çŸ¥æŸ”æ€§)</li><li>DSST æ•°å­—ç¬¦å·è½¬æ¢</li></ul>
            </a>
            <a href="emotion.html" class="card">
                <div class="card-header"><div class="icon">â¤ï¸</div><h2>æƒ…æ„Ÿ (CAS-EMO)</h2></div>
                <p class="domain-desc">ç»“åˆä¸»è§‚é‡è¡¨ä¸å®¢è§‚è¡Œä¸ºèŒƒå¼ï¼Œé‡åŒ–æƒ…ç»ªçŠ¶æ€ã€äººæ ¼ç‰¹è´¨ã€é£é™©åå¥½åŠæ½œåœ¨çš„æ³¨æ„åå‘ã€‚</p>
                <ul class="sub-test-list"><li>EMA è¿ç»­ç¬æ—¶çŠ¶æ€è¯„ä¼°</li><li>Big 5 äººæ ¼ç‰¹è´¨è¯„ä¼°</li><li>BART æ°”çƒæ¨¡æ‹Ÿé£é™©å†³ç­–</li><li>Emotional Stroop æ³¨æ„åå‘</li></ul>
            </a>
            <a href="motor.html" class="card">
                <div class="card-header"><div class="icon">ğŸ¯</div><h2>è¿åŠ¨ (CAS-MOT)</h2></div>
                <p class="domain-desc">é¶å‘è¿åŠ¨çš®å±‚ã€å°è„‘åŠåŸºåº•èŠ‚ã€‚è®°å½•æé«˜åˆ†è¾¨ç‡çš„è§¦å±è½¨è¿¹ï¼Œæ•æ‰å¾®å°å…±æµå¤±è°ƒä¸éœ‡é¢¤ç‰¹å¾ã€‚</p>
                <ul class="sub-test-list"><li>Simple Tapping è¿åŠ¨ç–²åŠ³åº¦</li><li>Fitts' Law é¶å‘åè°ƒæ€§</li><li>Archimedean èºæ—‹çº¿éœ‡é¢¤</li></ul>
            </a>
            <a href="sensation.html" class="card">
                <div class="card-header"><div class="icon">âš¡</div><h2>æ„Ÿè§‰ä¸çŸ¥è§‰ (CAS-SEN)</h2></div>
                <p class="domain-desc">åˆ†ç¦»ç¥ç»ä¼ å¯¼åŸºçº¿ä¸è®¤çŸ¥å†³ç­–æ—¶é—´ï¼Œè¯„ä¼°è§†è§‰ä¿¡æ¯è·å–æ•ˆç‡ã€æŠ‘åˆ¶æ§åˆ¶ä¸æœç´¢èƒ½åŠ›ã€‚</p>
                <ul class="sub-test-list"><li>Simple RT (åŸºçº¿ååº”æ—¶)</li><li>Choice RT (çŸ¥è§‰å†³ç­–)</li><li>Go/No-Go (æ„Ÿè§‰æŠ‘åˆ¶)</li><li>Visual Search (ç‰¹å¾æ³¨æ„)</li></ul>
            </a>
            <a href="language.html" class="card" style="border-top: 4px solid #8b5cf6;">
                <div class="card-header"><div class="icon">ğŸ’¬</div><h2>è¯­è¨€ (CAS-LAN)</h2></div>
                <p class="domain-desc">é¶å‘é¢å¶ä¸é¢ä¸‹å›ï¼Œé€šè¿‡è¯æ±‡æ£€ç´¢é€Ÿåº¦ä¸å›¾åƒå‘½åæ•ˆç‡ï¼Œé‡åŒ–è¯­ä¹‰ç½‘ç»œçš„è¿é€šæ€§è¡°é€€ã€‚</p>
                <ul class="sub-test-list"><li>VFT è¯æ±‡æµç•…æ€§ (è¯­ä¹‰æå–)</li><li>Naming å›¾ç‰‡å‘½å (æå–æ—¶å»¶)</li></ul>
            </a>
            <a href="lifestyle.html" class="card" style="border-top: 4px solid #10b981;">
                <div class="card-header"><div class="icon">ğŸŒ™</div><h2>ä¸»è§‚ä¸èŠ‚å¾‹ (CAS-LIF)</h2></div>
                <p class="domain-desc">é‡‡é›†ä¸»è§‚è®¤çŸ¥ä¸‹é™ (SCD) çš„æ—©æœŸé¢„è­¦ä¿¡å·ï¼Œä»¥åŠä¸æ·€ç²‰æ ·è›‹ç™½æ²‰ç§¯å¼ºç›¸å…³çš„ç¡çœ æŒ‡æ ‡ã€‚</p>
                <ul class="sub-test-list"><li>SCD-Q ä¸»è§‚è®¤çŸ¥ä¸‹é™é¢„è­¦</li><li>å¾®å‹ç¡çœ ä¸ç”Ÿç‰©èŠ‚å¾‹è´¨æ§</li></ul>
            </a>
        </div>
        <a href="report.html" class="data-btn"><span>ğŸ“Š</span> è¿›å…¥ä¸´åºŠæ•°æ®ä¸­å¿ƒ (å¯¼å‡ºæœ¬è¢«è¯• JSON æ•°æ®)</a>
    </div>

    <script>
        // é¡µé¢åŠ è½½æ—¶çš„è·¯ç”±æ§åˆ¶
        window.onload = function() {
            if (CAS_Storage.hasSession()) {
                // å¦‚æœå·²ç»å»ºæ¡£ï¼Œéšè—è¡¨å•ï¼Œæ˜¾ç¤ºä»ªè¡¨ç›˜
                document.getElementById('setup-container').style.display = 'none';
                document.getElementById('dashboard-container').style.display = 'block';
                
                // åŠ è½½è¢«è¯•ä¿¡æ¯åˆ°å¤´éƒ¨ Badge
                const session = CAS_Storage.getSession();
                document.getElementById('display-subj-name').innerText = session.demographics.name;
                document.getElementById('display-subj-id').innerText = session.session_id;
            } else {
                // å¦‚æœæœªå»ºæ¡£ï¼Œæ˜¾ç¤ºè¡¨å•
                document.getElementById('setup-container').style.display = 'block';
                document.getElementById('dashboard-container').style.display = 'none';
            }
        };

        // å¤„ç†è¡¨å•æäº¤ä¸æ ¡éªŒ
        function registerSubject() {
            const id = document.getElementById('subj-id').value.trim();
            const name = document.getElementById('subj-name').value.trim();
            const dob = document.getElementById('subj-dob').value;
            const gender = document.getElementById('subj-gender').value;
            const hand = document.getElementById('subj-hand').value;
            const edu = document.getElementById('subj-edu').value; // é€‰å¡«

            // ä¸¥æ ¼çš„å¿…å¡«é¡¹æ ¡éªŒ
            if(!id || !name || !dob || !gender || !hand) {
                alert("âš ï¸ è¯·å®Œæ•´å¡«å†™æ‰€æœ‰å¸¦ * çš„å¿…å¡«é¡¹ï¼è¿™å¯¹äºåç»­æ•°æ®çš„å¸¸æ¨¡æ ¡æ­£éå¸¸é‡è¦ã€‚");
                return;
            }

            // åˆå§‹åŒ–ä¼šè¯å¹¶å°†äººå£å­¦ç‰¹å¾å†™å…¥åº•å±‚
            CAS_Storage.initSession({
                subject_id: id,
                name: name,
                dob: dob,
                gender: gender,
                handedness: hand,
                education_years: edu ? parseInt(edu) : null
            });

            // å¹³æ»‘åˆ‡æ¢è§†å›¾
            document.getElementById('setup-container').style.display = 'none';
            document.getElementById('display-subj-name').innerText = name;
            document.getElementById('display-subj-id').innerText = id;
            
            const dashboard = document.getElementById('dashboard-container');
            dashboard.style.display = 'block';
            dashboard.style.animation = "fadeIn 0.5s";
        }
    </script>
</body>
</html>
