<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>CAS - å¤šæ¨¡æ€æ•°å­—è¡¨å‹è¯„ä¼°ç³»ç»Ÿ</title>
    <style>
        /* ==================== 1. å…¨å±€è®¾è®¡è§„èŒƒ ==================== */
        :root { 
            --primary: #0f172a; 
            --blue: #3b82f6; 
            --bg: #f8fafc; 
            --text: #334155; 
            --muted: #64748b; 
        }
        body { 
            font-family: -apple-system, "PingFang SC", "Helvetica Neue", sans-serif; 
            background: var(--bg); 
            color: var(--text); 
            margin: 0; 
            padding: 20px; 
            -webkit-tap-highlight-color: transparent; 
        }
        
        header { 
            text-align: center; 
            margin-bottom: 25px; 
            padding: 35px 20px; 
            background: white; 
            border-radius: 16px; 
            box-shadow: 0 4px 20px rgba(0,0,0,0.04); 
            border-top: 6px solid var(--primary); 
        }
        header h1 { margin: 0 0 8px 0; font-size: 26px; color: var(--primary); }
        header p { margin: 0; font-size: 15px; color: var(--muted); }
        .eng-title { font-family: monospace; color: var(--blue); font-size: 13px; margin-top: 8px; display: block; }
        
        /* ==================== 2. å—è¯•è€…å»ºæ¡£è¡¨å• ==================== */
        #setup-container { 
            max-width: 700px; 
            margin: 30px auto; 
            background: white; 
            padding: 40px; 
            border-radius: 20px; 
            box-shadow: 0 10px 30px rgba(0,0,0,0.05); 
        }
        #setup-container h2 { margin-top: 0; color: var(--primary); border-bottom: 2px solid #e2e8f0; padding-bottom: 15px; margin-bottom: 25px; }
        .form-row { display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin-bottom: 20px; }
        .form-group label { display: block; font-weight: bold; font-size: 14px; margin-bottom: 8px; color: #1e293b; }
        .form-group label span { color: #ef4444; }
        .form-group input, .form-group select { width: 100%; box-sizing: border-box; padding: 14px; border: 2px solid #cbd5e1; border-radius: 10px; font-size: 16px; transition: 0.2s; background: #f8fafc; }
        .form-group input:focus, .form-group select:focus { border-color: var(--blue); background: white; outline: none; }
        
        .submit-btn { 
            width: 100%; padding: 18px; background: var(--blue); color: white; border: none; 
            border-radius: 12px; font-size: 18px; font-weight: bold; cursor: pointer; 
            transition: 0.2s; box-shadow: 0 4px 15px rgba(59,130,246,0.3); 
        }
        .submit-btn:hover { background: #2563eb; transform: translateY(-2px); }
        .submit-btn:active { transform: translateY(0); }

        /* ==================== 3. è¯„ä¼°çœ‹æ¿ä»ªè¡¨ç›˜ ==================== */
        #dashboard-container { display: none; animation: fadeIn 0.5s ease-out; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
        
        /* æ“ä½œæ‰‹å†Œ */
        .tutorial-container { max-width: 1200px; margin: 0 auto 30px auto; background: white; border-radius: 16px; display: flex; overflow: hidden; box-shadow: 0 4px 15px rgba(0,0,0,0.03); border: 1px solid #e2e8f0; flex-wrap: wrap; }
        .manual-section { flex: 1.5; padding: 30px; background: #f8fafc; border-right: 1px solid #e2e8f0; min-width: 300px; }
        .manual-section h3 { margin-top: 0; color: var(--primary); }
        .manual-list { padding-left: 20px; color: var(--muted); font-size: 14px; line-height: 1.7; margin: 0; }
        .manual-list li span { font-weight: bold; color: var(--blue); }
        
        /* äº¤äº’åé¦ˆç»„ä»¶ */
        .subj-badge { max-width: 1200px; margin: 0 auto 25px auto; padding: 15px 20px; background: #e0f2fe; color: #0369a1; border-radius: 12px; display: flex; justify-content: space-between; align-items: center; font-weight: bold; font-size: 15px; border: 1px solid #bae6fd; }
        
        /* å…­å¤§åŠŸèƒ½åŸŸç½‘æ ¼å¸ƒå±€ */
        .grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(340px, 1fr)); gap: 20px; max-width: 1200px; margin: 0 auto; }
        .card { 
            background: white; padding: 25px; border-radius: 16px; box-shadow: 0 4px 15px rgba(0,0,0,0.03); 
            text-decoration: none; color: inherit; border: 2px solid transparent; transition: 0.2s; 
            display: flex; flex-direction: column; position: relative;
        }
        .card:hover { transform: translateY(-5px); border-color: var(--blue); box-shadow: 0 12px 20px rgba(59,130,246,0.1); }
        
        .card-header { display: flex; align-items: center; gap: 15px; margin-bottom: 10px; } 
        .icon { font-size: 40px; } 
        .card h2 { color: var(--primary); margin: 0; font-size: 19px; }
        .domain-desc { font-size: 13px; color: #94a3b8; margin: 0 0 15px 0; padding-bottom: 15px; border-bottom: 1px solid #e2e8f0; line-height: 1.5; }
        
        .sub-test-list { list-style: none; padding: 0; margin: 0; flex-grow: 1; } 
        .sub-test-list li { font-size: 14px; color: var(--text); margin-bottom: 10px; display: flex; align-items: center; font-weight: 500; } 
        .sub-test-list li::before { content: "â€¢"; color: var(--blue); font-size: 20px; margin-right: 10px; }
        
        /* ğŸŒŸ æ ¸å¿ƒä¿®å¤ï¼šè§†è§‰å¼•å¯¼æŒ‰é’®ï¼Œå‘ŠçŸ¥ç”¨æˆ·ç‚¹å‡»å¡ç‰‡è¿›å…¥é¢æ¿ */
        .card-action {
            margin-top: 20px;
            padding: 12px;
            background: #eff6ff;
            color: var(--blue);
            text-align: center;
            border-radius: 10px;
            font-weight: bold;
            font-size: 14px;
            transition: 0.2s;
            border: 1px dashed #bfdbfe;
        }
        .card:hover .card-action { background: var(--blue); color: white; border-style: solid; }

        .data-btn { display: flex; justify-content: center; align-items: center; gap: 10px; max-width: 1200px; margin: 35px auto; padding: 20px; background: var(--blue); color: white; border-radius: 12px; text-decoration: none; font-size: 18px; font-weight: bold; box-shadow: 0 4px 15px rgba(59,130,246,0.3); transition: 0.2s; } 
        .data-btn:hover { background: #2563eb; transform: translateY(-2px); }
    </style>
    <script src="cas-storage.js"></script>
</head>
<body>
    <header>
        <h1>è®¡ç®—ç¥ç»å¿ƒç†ä¸æ•°å­—è¡¨å‹è¯„ä¼°ç³»ç»Ÿ (CAS)</h1>
        <p>åŸºäºå¤šæ¨¡æ€é«˜ç»´ç‰¹å¾æå–çš„ä¸´åºŠè¯„ä¼°ç»„åˆ</p>
        <span class="eng-title">Computational Assessment Suite for Digital Phenotyping</span>
    </header>

    <div id="setup-container">
        <h2>ğŸ“ å—è¯•è€…å»ºæ¡£ (Subject Registration)</h2>
        <div class="form-row">
            <div class="form-group"><label>è¢«è¯•ç¼–å· (ID) <span>*</span></label><input type="text" id="subj-id" placeholder="å¦‚ï¼šCAS_001"></div>
            <div class="form-group"><label>å§“åæ‹¼éŸ³/ç¼©å†™ <span>*</span></label><input type="text" id="subj-name" placeholder="å¦‚ï¼šZhangSan"></div>
        </div>
        <div class="form-row">
            <div class="form-group"><label>å‡ºç”Ÿå¹´æœˆæ—¥ <span>*</span></label><input type="date" id="subj-dob" min="1900-01-01" max="2099-12-31"></div>
            <div class="form-group"><label>æ€§åˆ« <span>*</span></label><select id="subj-gender"><option value="">è¯·é€‰æ‹©...</option><option value="Male">ç”· (Male)</option><option value="Female">å¥³ (Female)</option></select></div>
        </div>
        <div class="form-row">
            <div class="form-group"><label>åˆ©æ‰‹ (Handedness) <span>*</span></label><select id="subj-hand"><option value="">è¯·é€‰æ‹©...</option><option value="Right">å³æ‰‹ (Right)</option><option value="Left">å·¦æ‰‹ (Left)</option><option value="Ambidextrous">åŒåˆ©æ‰‹ (Ambi)</option></select></div>
            <div class="form-group"><label>å—æ•™è‚²å¹´é™</label><input type="number" id="subj-edu" placeholder="å¦‚ï¼š16" min="0" max="30"></div>
        </div>
        <button class="submit-btn" onclick="registerSubject()">âœ“ ä¿å­˜åŸºçº¿ä¿¡æ¯å¹¶å¼€å¯ä¼šè¯</button>
    </div>

    <div id="dashboard-container">
        <div class="tutorial-container">
            <div class="manual-section">
                <h3>ğŸ“‹ ä¸´åºŠä¸»è¯•æ“ä½œæ‰‹å†Œ</h3>
                <ul class="manual-list">
                    <li><span>ç¡¬ä»¶å»ºè®®ï¼š</span>æ¨èä½¿ç”¨ <strong>iPad æˆ–è§¦æ§å±è®¾å¤‡</strong>ï¼Œä»¥ä¿éšœè¿åŠ¨ç‰¹å¾é‡‡é›†çš„ç²¾åº¦ã€‚</li>
                    <li><span>äº¤äº’å¼•å¯¼ï¼š</span>ç‚¹å‡»ä¸‹æ–¹å„é¢†åŸŸå¡ç‰‡è¿›å…¥å¯¹åº”çš„æµ‹è¯•é¢æ¿ã€‚</li>
                    <li><span>æ•°æ®å¯¼å‡ºï¼š</span>æ‰€æœ‰ 22 é¡¹æµ‹éªŒå®Œæˆåï¼Œé€šè¿‡åº•éƒ¨â€œæ•°æ®ä¸­å¿ƒâ€å¯¼å‡º JSON ç»“æœåŒ…ã€‚</li>
                </ul>
            </div>
        </div>

        <div class="subj-badge">
            <span>å½“å‰æµ‹è¯•å¯¹è±¡: <span id="display-subj-name" style="color:#0f172a; margin:0 5px;"></span> ID: <span id="display-subj-id" style="color:#0f172a; font-family:monospace;"></span></span>
            <button onclick="CAS_Storage.clearSession()" style="background:white; border:1px solid #0369a1; color:#0369a1; padding:6px 15px; border-radius:8px; cursor:pointer; font-weight:bold; font-size:12px;">ç»“æŸä¼šè¯</button>
        </div>

        <div class="grid">
            <a href="cognition.html" class="card">
                <div class="card-header"><div class="icon">ğŸ§ </div><h2>è®¤çŸ¥ (CAS-COG)</h2></div>
                <p class="domain-desc">é¶å‘é¢å¶ä¸æµ·é©¬ä½“ï¼Œè¯„ä¼°æ‰§è¡Œæ§åˆ¶ã€è®°å¿†å¹¿åº¦ä¸å¤„ç†é€Ÿåº¦ã€‚</p>
                <ul class="sub-test-list">
                    <li>Corsi ç©ºé—´å·¥ä½œè®°å¿†</li>
                    <li>Stroop æ‰§è¡ŒæŠ‘åˆ¶æµ‹è¯•</li>
                    <li>TMT-B è®¤çŸ¥æŸ”æ€§è¿çº¿</li>
                    <li>DSST æ•°å­—ç¬¦å·è½¬æ¢</li>
                </ul>
                <div class="card-action">è¿›å…¥ è®¤çŸ¥ æµ‹è¯•é¢æ¿ â”</div>
            </a>
            
            <a href="emotion.html" class="card">
                <div class="card-header"><div class="icon">â¤ï¸</div><h2>æƒ…æ„Ÿ (CAS-EMO)</h2></div>
                <p class="domain-desc">é¶å‘è¾¹ç¼˜ç³»ç»Ÿï¼Œé‡åŒ–æƒ…ç»ªçŠ¶æ€ã€äººæ ¼ç‰¹è´¨åŠé£é™©åå¥½ã€‚</p>
                <ul class="sub-test-list">
                    <li>EMA è¿ç»­ç¬æ—¶çŠ¶æ€è¯„ä¼°</li>
                    <li>Big 5 äººæ ¼ç‰¹è´¨é‡è¡¨</li>
                    <li>BART æ°”çƒæ¨¡æ‹Ÿé£é™©å†³ç­–</li>
                    <li>Emotional Stroop æ³¨æ„åå‘</li>
                </ul>
                <div class="card-action">è¿›å…¥ æƒ…æ„Ÿ æµ‹è¯•é¢æ¿ â”</div>
            </a>
            
            <a href="motor.html" class="card">
                <div class="card-header"><div class="icon">ğŸ¯</div><h2>è¿åŠ¨ (CAS-MOT)</h2></div>
                <p class="domain-desc">é¶å‘è¿åŠ¨çš®å±‚ä¸å°è„‘ï¼Œè®°å½•éœ‡é¢¤ç‰¹å¾ä¸è¿åŠ¨åè°ƒæ€§ã€‚</p>
                <ul class="sub-test-list">
                    <li>Simple Tapping è¿åŠ¨ç–²åŠ³åº¦</li>
                    <li>Fitts' Law é¶å‘åè°ƒæ€§</li>
                    <li>Archimedean èºæ—‹çº¿éœ‡é¢¤åˆ†æ</li>
                </ul>
                <div class="card-action">è¿›å…¥ è¿åŠ¨ æµ‹è¯•é¢æ¿ â”</div>
            </a>
            
            <a href="sensation.html" class="card">
                <div class="card-header"><div class="icon">âš¡</div><h2>æ„Ÿè§‰çŸ¥è§‰ (CAS-SEN)</h2></div>
                <p class="domain-desc">è¯„ä¼°è§†è§‰ä¿¡æ¯å¤„ç†æ•ˆç‡ã€æ„Ÿè§‰ä¼ å¯¼ä¸æ³¨æ„åŠ›æ‰«æã€‚</p>
                <ul class="sub-test-list">
                    <li>Simple RT / Choice RT ååº”æ—¶</li>
                    <li>Go/No-Go å†²åŠ¨æŠ‘åˆ¶æ§åˆ¶</li>
                    <li>Visual Search è§†è§‰æœç´¢</li>
                </ul>
                <div class="card-action">è¿›å…¥ æ„Ÿè§‰ æµ‹è¯•é¢æ¿ â”</div>
            </a>
            
            <a href="language.html" class="card" style="border-top: 4px solid #8b5cf6;">
                <div class="card-header"><div class="icon">ğŸ’¬</div><h2>è¯­è¨€ (CAS-LAN)</h2></div>
                <p class="domain-desc">è¯„ä¼°è¯æ±‡æ£€ç´¢ã€å‘½åæ—¶å»¶åŠå†…éƒ¨è¯­ä¹‰ç½‘ç»œç‰©ç†è¿é€šæ€§ã€‚</p>
                <ul class="sub-test-list">
                    <li>VFT è¯æ±‡æµç•…æ€§æå–</li>
                    <li>Naming å›¾ç‰‡æ•°å­—åŒ–å‘½å</li>
                    <li>Semantic è¯­ä¹‰å…³è”ä¸æŠ½è±¡åˆ¤åˆ«</li>
                </ul>
                <div class="card-action" style="color: #8b5cf6; background: #f5f3ff;">è¿›å…¥ è¯­è¨€ æµ‹è¯•é¢æ¿ â”</div>
            </a>
            
            <a href="lifestyle.html" class="card" style="border-top: 4px solid #10b981;">
                <div class="card-header"><div class="icon">ğŸŒ™</div><h2>ç”Ÿæ´»ä¸»è§‚ (CAS-LIF)</h2></div>
                <p class="domain-desc">é‡‡é›†ä¸»è§‚è®¤çŸ¥è¯„ä»·ã€æ—¥å¸¸åŠŸèƒ½é‰´åˆ«åŠç¡çœ æŠ‘éƒè´¨æ§æŒ‡æ ‡ã€‚</p>
                <ul class="sub-test-list">
                    <li>SCD-Q ä¸»è§‚è®¤çŸ¥ä¸‹é™è‡ªè¯„</li>
                    <li>ç¡çœ ç»“æ„ä¸ç”Ÿç‰©èŠ‚å¾‹ç‰¹å¾</li>
                    <li>IADL å·¥å…·æ€§æ—¥å¸¸ç”Ÿæ´»èƒ½åŠ›è¯„ä¼°</li>
                    <li>PHQ-2 æŠ‘éƒæƒ…ç»ªé‰´åˆ«ç­›æŸ¥</li>
                </ul>
                <div class="card-action" style="color: #10b981; background: #ecfdf5;">è¿›å…¥ ç”Ÿæ´» æµ‹è¯•é¢æ¿ â”</div>
            </a>
        </div>
        
        <a href="report.html" class="data-btn"><span>ğŸ“Š</span> æŸ¥çœ‹ 22 é¡¹æµ‹è¯•è¿›åº¦ä¸æ•°æ®ä¸­å¿ƒ â”</a>
    </div>

    <script>
        // åˆå§‹åŒ–è®¾ç½®
        window.onload = function() {
            // é”å®šæ—¥æœŸä¸Šé™ä¸ºä»Šå¤©
            const today = new Date().toISOString().split("T")[0];
            document.getElementById('subj-dob').setAttribute("max", today);

            // ä¼šè¯æ£€æŸ¥
            if (CAS_Storage.hasSession()) {
                document.getElementById('setup-container').style.display = 'none'; 
                document.getElementById('dashboard-container').style.display = 'block';
                const session = CAS_Storage.getSession();
                document.getElementById('display-subj-name').innerText = session.demographics.name; 
                document.getElementById('display-subj-id').innerText = session.demographics.subject_id;
            } else { 
                document.getElementById('setup-container').style.display = 'block'; 
                document.getElementById('dashboard-container').style.display = 'none'; 
            }
        };

        // æ³¨å†Œå—è¯•è€…
        function registerSubject() {
            const id = document.getElementById('subj-id').value.trim();
            const name = document.getElementById('subj-name').value.trim();
            const dob = document.getElementById('subj-dob').value;
            const gender = document.getElementById('subj-gender').value;
            const hand = document.getElementById('subj-hand').value;
            const edu = document.getElementById('subj-edu').value;
            
            if(!id || !name || !dob || !gender || !hand) {
                return alert("âš ï¸ è¯·å®Œæ•´å¡«å†™æ‰€æœ‰å¿…å¡«é¡¹ï¼");
            }
            
            CAS_Storage.initSession({ 
                subject_id: id, 
                name: name, 
                dob: dob, 
                gender: gender, 
                handedness: hand, 
                education_years: edu ? parseInt(edu) : null 
            });
            
            location.reload(); // åˆ·æ–°ä»¥è¿›å…¥çœ‹æ¿
        }
    </script>
</body>
</html>
